{
    "content": "metadata = {\n    'protocolName': 'BP Genomics RNA Extraction',\n    'author': 'Chaz <chaz@opentrons.com',\n    'source': 'Custom Protocol Request',\n    'apiLevel': '2.2'\n}\n\n\ndef run(protocol):\n    [samps, mnt20, m1k] = get_values(  # noqa: F821\n    'samps', 'mnt20', 'm1k')\n\n    # load labware and pipettes\n    if samps > 16:\n        raise Exception('This protocol is in review; the maximum number of \\\n        supported samples is: 16')\n    tips1k = [protocol.load_labware('opentrons_96_filtertiprack_1000ul', '6')]\n    # tips20 definition needs to be updated - for current version of p.library\n    tips20 = [protocol.load_labware('opentrons_96_tiprack_20ul', '3')]\n\n    p20 = protocol.load_instrument('p20_single_gen2', mnt20, tip_racks=tips20)\n    p1k = protocol.load_instrument('p1000_single_gen2', m1k, tip_racks=tips1k)\n\n    magdeck = protocol.load_module('magdeck', '4')\n    magplate = magdeck.load_labware(\n                'usascientific_96_wellplate_2.4ml_deep', 'Deep Well Plate')\n    flatplate = protocol.load_labware(\n                'nest_96_wellplate_100ul_pcr_full_skirt', '1', 'Elution Plate')\n    trough = protocol.load_labware('nest_12_reservoir_15ml', '5', 'Trough')\n    liqwaste = protocol.load_labware(\n                'nest_1_reservoir_195ml', '8', 'Liquid Waste')\n    waste = liqwaste['A1'].top()  # may need to change\n    ie_rna = trough['A1']  # may need to change\n    bind1 = trough['A2']\n    \"\"\"\n    bind2 = trough['A3']\n    bind3 = trough['A4']\n    \"\"\"\n    washbuffer = trough['A5']\n    ethanol = trough['A7']\n    water = trough['A9']\n\n    magsamps = magplate.wells()[:samps]\n    elutes = flatplate.wells()[:samps]\n\n    # From nCoV - Add 4ul internal extraction control RNA\n    p20.pick_up_tip()\n    p20.flow_rate.aspirate = 10\n    p20.flow_rate.dispense = 20\n    p20.flow_rate.blow_out = 500\n\n    for dest in magsamps:\n        p20.transfer(4, ie_rna, dest.top(-2), new_tip='never')\n        p20.blow_out(dest.top(-2))\n\n    p20.drop_tip()\n\n    # Step 3 - Mix bind buffer, then add to samples\n    p1k.pick_up_tip()\n    p1k.mix(10, 800, bind1)\n    p1k.blow_out(bind1.top())\n    p1k.flow_rate.aspirate = 250  # slow down aspirate/dispense rates\n    p1k.flow_rate.dispense = 250\n\n    for dest in magsamps:\n        if not p1k.hw_pipette['has_tip']:\n            p1k.pick_up_tip()\n        p1k.transfer(400, bind1, dest, new_tip='never')\n        p1k.mix(5, 800, dest)\n        p1k.blow_out(dest.top())\n        p1k.drop_tip()\n\n    protocol.comment('Inucbating at room temp for 5 minutes.')\n    protocol.delay(minutes=5)\n\n    # Step 4 - engate magdeck for 6 minutes\n    magdeck.engage()\n    protocol.comment('Incubating on MagDeck for 6 minutes')\n    protocol.delay(minutes=6)\n\n    # Step 5 - remove supernatant\n\n    for src in magsamps:\n        p1k.transfer(804, src, waste)\n\n    magdeck.disengage()\n\n    def wash_step(src, vol, mtimes):\n        for dest in magsamps:\n            p1k.pick_up_tip()\n            p1k.transfer(vol, src, dest, new_tip='never', air_gap=50)\n            p1k.mix(mtimes, 750, dest)\n            p1k.blow_out(dest.top())\n            p1k.drop_tip()\n\n        magdeck.engage()\n        protocol.comment('Incubating on MagDeck for 5 minutes.')\n        protocol.delay(minutes=5)\n\n        for src in magsamps:\n            p1k.transfer(800, src, waste)\n\n        magdeck.disengage()\n\n    # Step 6, 7, 8\n    wash_step(washbuffer, 800, 10)\n\n    # Step 9, 10, 11\n    wash_step(ethanol, 800, 4)\n\n    # Additional wash step, if needed\n\n    # Step 19 - allow beads to dry for 10 minutes\n    protocol.comment('Allowing beads to air dry for 10 minutes.')\n    protocol.delay(minutes=10)\n\n    # Step 20 - Add 40 of nuclease free water and incubate for 2 minutes\n    for dest in magsamps:\n        p20.pick_up_tip()\n        p20.transfer(40, water, dest.top(), new_tip='never')\n        p20.mix(10, 20, dest)\n        p20.blow_out(dest.top())\n        p20.drop_tip()\n\n    protocol.comment('Incubating for 2 minutes.')\n    protocol.delay(minutes=2)\n\n    # Step 21 - Transfer elutes to clean plate\n    magdeck.engage()\n    protocol.comment('Incubating on MagDeck for 2 minutes.')\n    protocol.delay(minutes=2)\n\n    for src, dest in zip(magsamps, elutes):\n        p20.pick_up_tip()\n        p20.transfer(40, src, dest, new_tip='never')\n        p20.blow_out(dest.top())\n        p20.drop_tip()\n\n    protocol.comment('Congratulations, the protocol is complete. You can store \\\n    the samples or proceed to the next protocol with the samples.')\n",
    "custom_labware_defs": [],
    "fields": [
        {
            "default": 1,
            "label": "Number of Samples",
            "name": "samps",
            "type": "int"
        },
        {
            "label": "P20 Single Mount",
            "name": "mnt20",
            "options": [
                {
                    "label": "Left",
                    "value": "left"
                },
                {
                    "label": "Right",
                    "value": "right"
                }
            ],
            "type": "dropDown"
        },
        {
            "label": "P1000 Single Mount",
            "name": "m1k",
            "options": [
                {
                    "label": "Right",
                    "value": "right"
                },
                {
                    "label": "Left",
                    "value": "left"
                }
            ],
            "type": "dropDown"
        }
    ],
    "instruments": [
        {
            "mount": "left",
            "name": "p20_single_gen2"
        },
        {
            "mount": "right",
            "name": "p1000_single_gen2"
        }
    ],
    "labware": [
        {
            "name": "Elution Plate on 1",
            "share": false,
            "slot": "1",
            "type": "nest_96_wellplate_100ul_pcr_full_skirt"
        },
        {
            "name": "Opentrons 96 Tip Rack 20 \u00b5L on 3",
            "share": false,
            "slot": "3",
            "type": "opentrons_96_tiprack_20ul"
        },
        {
            "name": "Deep Well Plate on Magnetic Module on 4",
            "share": false,
            "slot": "4",
            "type": "usascientific_96_wellplate_2.4ml_deep"
        },
        {
            "name": "Trough on 5",
            "share": false,
            "slot": "5",
            "type": "nest_12_reservoir_15ml"
        },
        {
            "name": "Opentrons 96 Filter Tip Rack 1000 \u00b5L on 6",
            "share": false,
            "slot": "6",
            "type": "opentrons_96_filtertiprack_1000ul"
        },
        {
            "name": "Liquid Waste on 8",
            "share": false,
            "slot": "8",
            "type": "nest_1_reservoir_195ml"
        },
        {
            "name": "Opentrons Fixed Trash on 12",
            "share": false,
            "slot": "12",
            "type": "opentrons_1_trash_1100ml_fixed"
        }
    ],
    "metadata": {
        "apiLevel": "2.2",
        "author": "Chaz <chaz@opentrons.com",
        "protocolName": "BP Genomics RNA Extraction",
        "source": "Custom Protocol Request"
    },
    "modules": []
}