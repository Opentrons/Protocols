{
    "content": "metadata = {\n    'protocolName': 'SuperScript III: qRT-PCR Prep with CSV File',\n    'author': 'Rami Farawi <rami.farawi@opentrons.com>',\n    'source': 'Custom Protocol Request',\n    'apiLevel': '2.11'\n}\n\n\ndef run(ctx):\n\n    [csv, dna_asp_rate, p300_mount] = get_values(  # noqa: F821\n        \"csv\", \"dna_asp_rate\", \"p300_mount\")\n\n    # load Labware\n    dna_plate = ctx.load_labware('nest_96_wellplate_200ul_flat', 1)\n    final_plate = ctx.load_labware('nest_96_wellplate_200ul_flat', 2)\n    tuberack = ctx.load_labware('opentrons_6_tuberack_falcon_50ml_conical', 3)\n    tipracks = [ctx.load_labware('opentrons_96_tiprack_300ul', slot)\n                for slot in [4, 5]]\n\n    # load instrument\n    p300 = ctx.load_instrument(\"p300_single_gen2\", p300_mount,\n                               tip_racks=tipracks)\n\n    # mapping and parsing\n    te = tuberack.wells()[0]\n    csv_rows = [[val.strip() for val in line.split(',')]\n                for line in csv.splitlines()\n                if line.split(',')[0].strip()][1:]\n\n    num_samp = 0\n    for row in csv_rows:\n\n        if len(row[4]) == 0:\n            break\n        else:\n            num_samp += 1\n    csv_rows = csv_rows[:num_samp]\n\n    for row in csv_rows:\n        if int(row[4]) >= 200:\n            raise Exception(\"Volume greater than 200ul TE in csv file\")\n    num_samp = len(csv_rows)\n\n    # transferring TE\n    ctx.comment('\\n\\n TRANSFERRING TE TO PLATE\\n')\n    p300.pick_up_tip()\n    for well, row in zip(final_plate.wells()[:num_samp], csv_rows):\n        te_vol = int(row[4])\n        if te_vol > 0:\n            p300.aspirate(te_vol, te)\n            p300.dispense(te_vol, well)\n        else:\n            continue\n    p300.drop_tip()\n\n    ctx.comment('\\n\\n TRANSFERRING DNA TO PLATE\\n')\n    for source_well, dest_well, row in zip(final_plate.wells()[:num_samp],\n                                           dna_plate.wells(),\n                                           csv_rows):\n        dna_vol = int(row[2])\n        te_vol = int(row[4])\n        total_vol = te_vol + dna_vol\n        p300.pick_up_tip()\n        p300.aspirate(dna_vol, source_well.bottom(z=3), rate=dna_asp_rate)\n        p300.dispense(dna_vol, dest_well)\n        p300.mix(3, total_vol*0.8, dest_well)\n        p300.drop_tip()\n",
    "custom_labware_defs": [],
    "fields": [
        {
            "default": "Well,initial conc (ng/\u03bcL),initial volume (\u03bcL),final conc (ng/\u03bcL),volume to add (\u03bcL),Name,Pipette\nA1,1385,10,100,129,R1125 LBCC 1035 mix,P200",
            "label": ".CSV File",
            "name": "csv",
            "type": "textFile"
        },
        {
            "default": 0.5,
            "label": "DNA Aspiration Flow Rate",
            "name": "dna_asp_rate",
            "type": "float"
        },
        {
            "label": "P300 Single-Channel Mount",
            "name": "p300_mount",
            "options": [
                {
                    "label": "Left",
                    "value": "left"
                },
                {
                    "label": "Right",
                    "value": "right"
                }
            ],
            "type": "dropDown"
        }
    ],
    "instruments": [
        {
            "mount": "left",
            "name": "p300_single_gen2"
        }
    ],
    "labware": [
        {
            "name": "NEST 96 Well Plate 200 \u00b5L Flat on 1",
            "share": false,
            "slot": "1",
            "type": "nest_96_wellplate_200ul_flat"
        },
        {
            "name": "NEST 96 Well Plate 200 \u00b5L Flat on 2",
            "share": false,
            "slot": "2",
            "type": "nest_96_wellplate_200ul_flat"
        },
        {
            "name": "Opentrons 6 Tube Rack with Falcon 50 mL Conical on 3",
            "share": false,
            "slot": "3",
            "type": "opentrons_6_tuberack_falcon_50ml_conical"
        },
        {
            "name": "Opentrons 96 Tip Rack 300 \u00b5L on 4",
            "share": false,
            "slot": "4",
            "type": "opentrons_96_tiprack_300ul"
        },
        {
            "name": "Opentrons 96 Tip Rack 300 \u00b5L on 5",
            "share": false,
            "slot": "5",
            "type": "opentrons_96_tiprack_300ul"
        },
        {
            "name": "Opentrons Fixed Trash on 12",
            "share": false,
            "slot": "12",
            "type": "opentrons_1_trash_1100ml_fixed"
        }
    ],
    "metadata": {
        "apiLevel": "2.11",
        "author": "Rami Farawi <rami.farawi@opentrons.com>",
        "protocolName": "SuperScript III: qRT-PCR Prep with CSV File",
        "source": "Custom Protocol Request"
    },
    "modules": []
}