{
    "content": "from opentrons import types\n\nmetadata = {\n    'protocolName': '''LC-MS Sample Prep: part 1 -\n                       Standards/Calibration Curves''',\n    'author': 'Steve Plonk <protocols@opentrons.com>',\n    'apiLevel': '2.9'\n}\n\n\ndef run(ctx):\n\n    # get parameter values from json above\n    [labware_tips20, labware_tips300, labware_tuberack, clearance_meoh_water,\n     clearance_dil_dispense, touch_radius, touch_v_offset, track_start,\n     clearance_tfa, clearance_mecn] = get_values(  # noqa: F821\n      'labware_tips20', 'labware_tips300', 'labware_tuberack',\n      'clearance_meoh_water', 'clearance_dil_dispense', 'touch_radius',\n      'touch_v_offset', 'track_start', 'clearance_tfa', 'clearance_mecn')\n\n    ctx.set_rail_lights(True)\n\n    # tips, p20 multi gen2, p300 multi gen2\n    tips20 = [ctx.load_labware(\n     labware_tips20, str(slot)) for slot in [2]]\n    p20s = ctx.load_instrument(\n        \"p20_single_gen2\", 'left', tip_racks=tips20)\n    tips300 = [ctx.load_labware(labware_tips300, str(slot)) for slot in [6]]\n    p300s = ctx.load_instrument(\n        \"p300_single_gen2\", 'right', tip_racks=tips300)\n\n    \"\"\"\n    helper functions\n    \"\"\"\n\n    def pause_attention(message):\n        ctx.set_rail_lights(False)\n        ctx.delay(seconds=10)\n        ctx.pause(message)\n        ctx.set_rail_lights(True)\n\n    def slow_tip_withdrawal(current_pipette, well_location, to_center=False):\n        if current_pipette.mount == 'right':\n            axis = 'A'\n        else:\n            axis = 'Z'\n        ctx.max_speeds[axis] = 10\n        if to_center is False:\n            current_pipette.move_to(well_location.top())\n        else:\n            current_pipette.move_to(well_location.center())\n        ctx.max_speeds[axis] = None\n\n    def pre_wet(current_pipette, volume, location):\n        for rep in range(2):\n            current_pipette.aspirate(volume, location)\n            current_pipette.dispense(volume, location)\n\n    def meoh_flow_rates(current_pipette):\n        if (current_pipette.name == 'p300_multi_gen2' or\n           current_pipette.name == 'p300_single_gen2'):\n            current_pipette.flow_rate.aspirate = 92.86\n            current_pipette.flow_rate.dispense = 300\n            current_pipette.flow_rate.blow_out = 300\n        elif (current_pipette.name == 'p20_multi_gen2' or\n              current_pipette.name == 'p20_single_gen2'):\n            current_pipette.flow_rate.aspirate = 7.56\n            current_pipette.flow_rate.dispense = 22\n            current_pipette.flow_rate.blow_out = 22\n\n    def plasma_flow_rates(current_pipette):\n        if (current_pipette.name == 'p300_multi_gen2' or\n           current_pipette.name == 'p300_single_gen2'):\n            current_pipette.flow_rate.aspirate = 60\n            current_pipette.flow_rate.dispense = 60\n            current_pipette.flow_rate.blow_out = 60\n        elif (current_pipette.name == 'p20_multi_gen2' or\n              current_pipette.name == 'p20_single_gen2'):\n            current_pipette.flow_rate.aspirate = 3.5\n            current_pipette.flow_rate.dispense = 3.5\n            current_pipette.flow_rate.blow_out = 3.5\n\n    def default_flow_rates(current_pipette):\n        if (current_pipette.name == 'p300_multi_gen2' or\n           current_pipette.name == 'p300_single_gen2'):\n            current_pipette.flow_rate.aspirate = 92.86\n            current_pipette.flow_rate.dispense = 92.86\n            current_pipette.flow_rate.blow_out = 92.86\n        elif (current_pipette.name == 'p20_multi_gen2' or\n              current_pipette.name == 'p20_single_gen2'):\n            current_pipette.flow_rate.aspirate = 7.56\n            current_pipette.flow_rate.dispense = 7.56\n            current_pipette.flow_rate.blow_out = 7.56\n\n    ctx.comment(\"\"\"\n    tube rack in deck slot 1:\n    A1-A6,B1-B6 - 200 uM unlabeled solution\n    followed by 11 serial 1:2 dilutions\n    D1 - 100 uM labeled solution\n    D2 - 1:1 MeOH:Water\n    D3 - 100 mM NEM\n    D4 - Golden Plasma\n    reservoir in deck slot 5:\n    A1 - TFA in MeCN\n    A2 - 4:1 MeCN:Water\n    \"\"\")\n\n    # reagents and dilutions\n    tuberack = ctx.load_labware(\n     labware_tuberack, '1', 'Tube Rack')\n    unlabeled_soln_200um, *dilutions = [\n     well for row in tuberack.rows() for well in row][:12]\n    labeled_soln_100um, meoh_water, nem_100mm, golden_plasma = [\n     tuberack.wells_by_name()[well] for well in ['D1', 'D2', 'D3', 'D4']]\n    reservoir = ctx.load_labware('nest_12_reservoir_15ml', '5', 'Reservoir')\n    tfa = reservoir.wells_by_name()['A1']\n    mecn = reservoir.wells_by_name()['A2']\n\n    # samples\n    sample_tuberack = ctx.load_labware(\n     labware_tuberack, '4', 'Sample Tube Rack')\n    [*samples] = [well for row in sample_tuberack.rows() for well in row][:12]\n    [*amicon_filters] = [\n     well for row in sample_tuberack.rows() for well in row][12:]\n\n    ctx.delay(seconds=10)\n    pause_attention(\"\"\"\n    Set up: Unlabeled 200 uM soln in A1 of tuberack deck slot 1,\n    1:2 dilutions in A2-A6,B1-B6 in tuberack slot 1,\n    1:1 MeOH:Water in D2 in tuberack slot 1\n    Labeled 100 uM soln in D1 tuberack slot 1\n    100 mM NEM in D3 tuberack slot 1\n    Golden Plasma in D4 tuberack slot 1\n    12 sample tubes in A1-A6, B1-B6 of tuberack deck slot 4\n    12 amicon filters in C1-C6, D1-D6 of tuberack deck slot 4\n    reservoir with TFA in MeCN and MeCN:Water in deck slot 5\n    p20 tips in slot 2\n    p300 tips in slot 6.\n    \"\"\")\n\n    ctx.comment(\"\"\"\n    add 20 ul 1:1 MeOH:Water (one tube at a time, pausing to vortex)\n    to make 11 serial dilutions 1:2 from unlabelled 200 um solution in A1\n\n    liquid handling method for methanol:water:\n    fast flow rate for blow out\n    pre-wet the tips twice (saturate air)\n    15 ul air gap\n    delayed blowout after dispense (let meoh fall to bottom of tip first)\n    repeat blowout (for complete dispense)\n    tip touch\n    \"\"\")\n\n    meoh_flow_rates(p300s)\n    for index, dilution in enumerate(dilutions):\n        p300s.pick_up_tip()\n        pre_wet(p300s, 150, meoh_water.bottom(clearance_meoh_water))\n        p300s.aspirate(20, meoh_water.bottom(clearance_meoh_water))\n        p300s.air_gap(15)\n        p300s.dispense(35, dilution.bottom(clearance_dil_dispense))\n        for rep in range(3):\n            if rep > 0:\n                p300s.aspirate(\n                 100, dilution.bottom(clearance_dil_dispense))\n            ctx.delay(seconds=1)\n            p300s.blow_out(dilution.bottom(clearance_dil_dispense))\n        p300s.touch_tip(radius=touch_radius, v_offset=touch_v_offset, speed=20)\n        if index == 0:\n            source = unlabeled_soln_200um.bottom(1)\n        else:\n            source = dilutions[index-1].bottom(1)\n        p300s.aspirate(20, source)\n        p300s.air_gap(15)\n        p300s.dispense(35, dilution.bottom(clearance_dil_dispense))\n        for rep in range(3):\n            if rep > 0:\n                p300s.aspirate(\n                 100, dilution.bottom(clearance_dil_dispense))\n            ctx.delay(seconds=1)\n            p300s.blow_out(dilution.bottom(clearance_dil_dispense))\n        p300s.touch_tip(radius=touch_radius, v_offset=touch_v_offset, speed=20)\n        p300s.move_to(dilution.top().move(types.Point(x=0, y=0, z=25)))\n        ctx.pause(\"\"\"Vortex and return the tube.\"\"\")\n        p300s.drop_tip()\n    default_flow_rates(p300s)\n\n    ctx.comment(\"\"\"\n    add 90 ul Golden Plasma to each of 12 sample tubes\n\n    use liquid handling method for plasma\n    aspirate extra volume\n    prewet tip\n    reduced aspirate and dispense speeds\n    slow tip withdrawal from plasma\n    avoid over-immersion of tip (liquid height tracking)\n    \"\"\")\n\n    plasma_flow_rates(p300s)\n    p300s.pick_up_tip()\n    starting_clearance = track_start\n    tracking_clearance = starting_clearance\n    ending_clearance = 2\n    increment = (starting_clearance - ending_clearance) / len(samples)\n    p300s.aspirate(35, golden_plasma.bottom(starting_clearance))\n    pre_wet(p300s, 100, golden_plasma.bottom(starting_clearance))\n    for sample in samples:\n        p300s.aspirate(90, golden_plasma.bottom(tracking_clearance))\n        slow_tip_withdrawal(p300s, golden_plasma)\n        if tracking_clearance >= ending_clearance + increment:\n            tracking_clearance -= increment\n        else:\n            tracking_clearance = ending_clearance\n        p300s.dispense(90, sample.bottom(2))\n        slow_tip_withdrawal(p300s, sample)\n    p300s.drop_tip()\n    default_flow_rates(p300s)\n\n    ctx.comment(\"\"\"\n    transfer 10 ul of each serial dilution to the corresponding sample tube\n    vortex 5 min\n    use liquid handling method for MeOH:Water\n    \"\"\")\n    meoh_flow_rates(p20s)\n    dilutions.insert(0, unlabeled_soln_200um)\n    for index, dilution in enumerate(dilutions):\n        p20s.pick_up_tip()\n        pre_wet(p20s, 20, meoh_water.bottom(clearance_meoh_water))\n        p20s.aspirate(10, dilution.bottom(clearance_dil_dispense))\n        p20s.air_gap(2)\n        p20s.dispense(12, samples[index].bottom(3))\n        slow_tip_withdrawal(p20s, samples[index], to_center=True)\n        for rep in range(3):\n            if rep > 0:\n                p20s.aspirate(10, samples[index].center())\n            ctx.delay(seconds=1)\n            p20s.blow_out(samples[index].center())\n        p20s.touch_tip(radius=0.75, v_offset=-2, speed=20)\n        p20s.drop_tip()\n    default_flow_rates(p20s)\n\n    pause_attention(\"Vortex samples 5 min and return.\")\n\n    ctx.comment(\"\"\"\n    add 10 ul NEM to each sample tube\n    vortex 15 min\n    \"\"\")\n    for sample in samples:\n        p20s.pick_up_tip()\n        p20s.aspirate(10, nem_100mm.bottom(3))\n        p20s.dispense(10, sample.bottom(3))\n        slow_tip_withdrawal(p20s, sample, to_center=True)\n        p20s.blow_out(sample.center())\n        p20s.touch_tip(radius=0.75, v_offset=-2, speed=20)\n        p20s.drop_tip()\n\n    pause_attention(\"Vortex samples 15 min and return.\")\n\n    ctx.comment(\"\"\"\n    add 5 ul 100 uM labelled standard to each sample tube\n    vortex 5 min\n    use liquid handling method for MeOH:Water\n    \"\"\")\n    meoh_flow_rates(p20s)\n    for sample in samples:\n        p20s.pick_up_tip()\n        pre_wet(p20s, 15, labeled_soln_100um.bottom(2))\n        p20s.aspirate(5, labeled_soln_100um.bottom(2))\n        p20s.air_gap(2)\n        p20s.dispense(7, sample.bottom(3))\n        slow_tip_withdrawal(p20s, sample, to_center=True)\n        for rep in range(3):\n            if rep > 0:\n                p20s.aspirate(10, sample.center())\n            ctx.delay(seconds=1)\n            p20s.blow_out(sample.center())\n        p20s.touch_tip(radius=0.75, v_offset=-2, speed=20)\n        p20s.drop_tip()\n    default_flow_rates(p20s)\n\n    pause_attention(\"Vortex samples 5 min and return.\")\n\n    ctx.comment(\"\"\"\n    add 540 ul TFA in acetonitrile to each sample tube\n    vortex 10 min\n    spin 15 min\n    use same liquid handling method as for MeOH:Water\n    \"\"\")\n    meoh_flow_rates(p300s)\n    p300s.pick_up_tip()\n    for sample in samples:\n        pre_wet(p300s, 150, tfa.bottom(clearance_tfa))\n        for rep in range(3):\n            p300s.aspirate(180, tfa.bottom(clearance_tfa))\n            p300s.air_gap(15)\n            p300s.dispense(195, sample.top())\n            for rep in range(3):\n                if rep > 0:\n                    p300s.aspirate(180, sample.top())\n                ctx.delay(seconds=1)\n                p300s.blow_out(sample.top())\n    p300s.drop_tip()\n    default_flow_rates(p300s)\n\n    pause_attention(\"Vortex samples 10 min, spin 15 min, and return.\")\n\n    ctx.comment(\"\"\"\n    transfer 500 ul sup from each sample tube to Amicon filter\n    spin 2.5 hours\n    dry in speedvac aqueous dry setting 1.5 hours\n    return\n    resuspend in 4:1 acetonitrile:water\n    use same liquid handling method as for MeOH:Water\n    \"\"\")\n    for index, sample in enumerate(samples):\n        p300s.pick_up_tip()\n        default_flow_rates(p300s)\n        pre_wet(p300s, 150, sample.bottom(5))\n        meoh_flow_rates(p300s)\n        for rep in range(3):\n            p300s.aspirate(166.7, sample.bottom(5))\n            p300s.air_gap(15)\n            p300s.dispense(181.7, amicon_filters[index].top())\n            for rep in range(3):\n                if rep > 0:\n                    p300s.aspirate(180, amicon_filters[index].top())\n                ctx.delay(seconds=1)\n                p300s.blow_out(amicon_filters[index].top())\n            p300s.touch_tip(radius=0.75, v_offset=-2, speed=20)\n        p300s.drop_tip()\n    default_flow_rates(p300s)\n\n    pause_attention(\"Spin filters 2.5 hours, dry 1.5 hours, return.\")\n\n    meoh_flow_rates(p300s)\n    for filter in amicon_filters:\n        p300s.pick_up_tip()\n        pre_wet(p300s, 150, mecn.bottom(clearance_mecn))\n        p300s.aspirate(40, mecn.bottom(clearance_mecn))\n        p300s.air_gap(15)\n        p300s.dispense(55, filter.top())\n        for rep in range(3):\n            if rep > 0:\n                p300s.aspirate(180, filter.top())\n            ctx.delay(seconds=1)\n            p300s.blow_out(filter.top())\n        p300s.touch_tip(radius=0.75, v_offset=-2, speed=20)\n        p300s.drop_tip()\n    default_flow_rates(p300s)\n\n    pause_attention(\"Transfer to vials, load QQQ7 LC-MS, inject 5 \u03bcl.\")\n",
    "custom_labware_defs": [],
    "fields": [
        {
            "label": "Chooose 20 ul Tips",
            "name": "labware_tips20",
            "options": [
                {
                    "label": "Standard 20 ul Tips",
                    "value": "opentrons_96_tiprack_20ul"
                },
                {
                    "label": "20 ul Filter Tips",
                    "value": "opentrons_96_filtertiprack_20ul"
                }
            ],
            "type": "dropDown"
        },
        {
            "label": "Chooose 300 ul Tips",
            "name": "labware_tips300",
            "options": [
                {
                    "label": "Standard 300 ul Tips",
                    "value": "opentrons_96_tiprack_300ul"
                },
                {
                    "label": "300 ul Filter Tips",
                    "value": "opentrons_96_filtertiprack_300ul"
                }
            ],
            "type": "dropDown"
        },
        {
            "label": "Labware for Tube Rack",
            "name": "labware_tuberack",
            "options": [
                {
                    "label": "opentrons_24_tuberack_nest_1.5ml_snapcap",
                    "value": "opentrons_24_tuberack_nest_1.5ml_snapcap"
                }
            ],
            "type": "dropDown"
        },
        {
            "default": 5,
            "label": "Aspirate and Dispense Height for MeOH:Water Tube (mm)",
            "name": "clearance_meoh_water",
            "type": "float"
        },
        {
            "default": 5,
            "label": "Dispense Height for Serial Dilutions (mm)",
            "name": "clearance_dil_dispense",
            "type": "float"
        },
        {
            "default": 0.3,
            "label": "Touch Tip Radius for Serial Dilutions (fraction of a radius)",
            "name": "touch_radius",
            "type": "float"
        },
        {
            "default": -10,
            "label": "Touch Tip Vertical Offset for Serial Dilutions (mm from top)",
            "name": "touch_v_offset",
            "type": "float"
        },
        {
            "default": 10,
            "label": "Starting Aspirate Height for Golden Plasma (mm)",
            "name": "track_start",
            "type": "int"
        },
        {
            "default": 3,
            "label": "Well Bottom Clearance for TFA in Reservoir (mm)",
            "name": "clearance_tfa",
            "type": "float"
        },
        {
            "default": 3,
            "label": "Well Bottom Clearance for Acetonitrile in Reservoir (mm)",
            "name": "clearance_mecn",
            "type": "float"
        }
    ],
    "instruments": [
        {
            "mount": "left",
            "name": "p20_single_gen2"
        },
        {
            "mount": "right",
            "name": "p300_single_gen2"
        }
    ],
    "labware": [
        {
            "name": "Tube Rack on 1",
            "share": false,
            "slot": "1",
            "type": "opentrons_24_tuberack_nest_1.5ml_snapcap"
        },
        {
            "name": "Opentrons 96 Tip Rack 20 \u00b5L on 2",
            "share": false,
            "slot": "2",
            "type": "opentrons_96_tiprack_20ul"
        },
        {
            "name": "Sample Tube Rack on 4",
            "share": false,
            "slot": "4",
            "type": "opentrons_24_tuberack_nest_1.5ml_snapcap"
        },
        {
            "name": "Reservoir on 5",
            "share": false,
            "slot": "5",
            "type": "nest_12_reservoir_15ml"
        },
        {
            "name": "Opentrons 96 Tip Rack 300 \u00b5L on 6",
            "share": false,
            "slot": "6",
            "type": "opentrons_96_tiprack_300ul"
        },
        {
            "name": "Opentrons Fixed Trash on 12",
            "share": false,
            "slot": "12",
            "type": "opentrons_1_trash_1100ml_fixed"
        }
    ],
    "metadata": {
        "apiLevel": "2.9",
        "author": "Steve Plonk <protocols@opentrons.com>",
        "protocolName": "LC-MS Sample Prep: part 1 -\n                       Standards/Calibration Curves"
    },
    "modules": []
}