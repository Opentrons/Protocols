{
    "content": "from opentrons import protocol_api\n\n# DNA concentration quantified samples normalization\nmetadata = {\n    'protocolName': '466f93-5 - Automated LifeCell_NIPT_35Plex_HV',\n    'author': 'Eskil Andersen <eskil.andersen@opentrons.com>',\n    'source': 'Custom Protocol Request',\n    'description': 'Normalization protocol',\n    'apiLevel': '2.11'   # CHECK IF YOUR API LEVEL HERE IS UP TO DATE\n                         # IN SECTION 5.2 OF THE APIV2 \"VERSIONING\"\n}\n\n\ndef run(ctx: protocol_api.ProtocolContext):\n    [\n     num_samples,\n     normalization_csv\n    ] = get_values(  # noqa: F821 (<--- DO NOT REMOVE!)\n        \"num_samples\",\n        \"normalization_csv\")\n\n    # load modules\n    mag_mod = ctx.load_module('magnetic module gen2', '3')\n\n    '''\n\n    Add your modules here with:\n\n    module_name = ctx.load_module('{module_loadname}', '{slot number}')\n\n    Note: if you are loading a thermocycler, you do not need to specify\n    a slot number - thermocyclers will always occupy slots 7, 8, 10, and 11.\n\n    For all other modules, you can load them on slots 1, 3, 4, 6, 7, 9, 10.\n\n    '''\n\n    # load labware\n\n    '''\n\n    Add your labware here with:\n\n    labware_name = ctx.load_labware('{loadname}', '{slot number}')\n\n    If loading labware on a module, you can load with:\n\n    labware_name = module_name.load_labware('{loadname}')\n    where module_name is defined above.\n\n    '''\n    mag_bead_cleanup_plate \\\n        = mag_mod.load_labware('nest_96_wellplate_100ul_pcr_full_skirt',\n                               'Magnetic module sample plate')\n    SPRI_bead_plate \\\n        = ctx.load_labware('nest_96_wellplate_100ul_pcr_full_skirt', '9',\n                           'Magnetic bead plate')\n    reservoir \\\n        = ctx.load_labware('nest_12_reservoir_15ml', '6',\n                           'Reagent reservoir')\n    qubit_sample_plate \\\n        = ctx.load_labware('nest_96_wellplate_100ul_pcr_full_skirt', '1',\n                           'quantification plate')\n    PCR_amplified_sample_plate \\\n        = ctx.load_labware('nest_96_wellplate_100ul_pcr_full_skirt', '2',\n                           'quantification plate')\n    normalization_plate \\\n        = ctx.load_labware('nest_96_wellplate_100ul_pcr_full_skirt', '4',\n                           'Normalization plate')\n\n    # load tipracks\n\n    '''\n\n    Add your tipracks here as a list:\n\n    For a single tip rack:\n\n    tiprack_name = [ctx.load_labware('{loadname}', '{slot number}')]\n\n    For multiple tip racks of the same type:\n\n    tiprack_name = [ctx.load_labware('{loadname}', 'slot')\n                     for slot in ['1', '2', '3']]\n\n    If two different tipracks are on the deck, use convention:\n    tiprack[number of microliters]\n    e.g. tiprack10, tiprack20, tiprack200, tiprack300, tiprack1000\n\n    '''\n    tiprack20s = [ctx.load_labware('opentrons_96_filtertiprack_20ul', slot)\n                  for slot in ['10', '11']]\n    tiprack200s = [ctx.load_labware('opentrons_96_filtertiprack_200ul', slot)\n                   for slot in ['5', '8']]\n\n    # load instrument\n\n    '''\n    Nomenclature for pipette:\n\n    use 'p'  for single-channel, 'm' for multi-channel,\n    followed by number of microliters.\n\n    p20, p300, p1000 (single channel pipettes)\n    m20, m300 (multi-channel pipettes)\n\n    If loading pipette, load with:\n\n    ctx.load_instrument(\n                        '{pipette api load name}',\n                        pipette_mount (\"left\", or \"right\"),\n                        tip_racks=tiprack\n                        )\n    '''\n    p20 = ctx.load_instrument(\"p20_single_gen2\", \"left\", tip_racks=tiprack20s)\n    p300 = ctx.load_instrument(\"p300_single_gen2\", \"right\",\n                               tip_racks=tiprack200s)\n\n    # pipette functions   # INCLUDE ANY BINDING TO CLASS\n\n    '''\n\n    Define all pipette functions, and class extensions here.\n    These may include but are not limited to:\n\n    - Custom pickup functions\n    - Custom drop tip functions\n    - Custom Tip tracking functions\n    - Custom Trash tracking functions\n    - Slow tip withdrawal\n\n    For any functions in your protocol, describe the function as well as\n    describe the parameters which are to be passed in as a docstring below\n    the function (see below).\n\n    def pick_up(pipette):\n        \"\"\"`pick_up()` will pause the protocol when all tip boxes are out of\n        tips, prompting the user to replace all tip racks. Once tipracks are\n        reset, the protocol will start picking up tips from the first tip\n        box as defined in the slot order when assigning the labware definition\n        for that tip box. `pick_up()` will track tips for both pipettes if\n        applicable.\n\n        :param pipette: The pipette desired to pick up tip\n        as definited earlier in the protocol (e.g. p300, m20).\n        \"\"\"\n        try:\n            pipette.pick_up_tip()\n        except protocol_api.labware.OutOfTipsError:\n            ctx.pause(\"Replace empty tip racks\")\n            pipette.reset_tipracks()\n            pipette.pick_up_tip()\n\n    '''\n\n    # helper functions\n    '''\n    Define any custom helper functions outside of the pipette scope here, using\n    the convention seen above.\n\n    e.g.\n\n    def remove_supernatant(vol, index):\n        \"\"\"\n        function description\n\n        :param vol:\n\n        :param index:\n        \"\"\"\n\n\n    '''\n\n    # reagents\n\n    '''\n    Define where all reagents are on the deck using the labware defined above.\n\n    e.g.\n\n    water = reservoir12.wells()[-1]\n    waste = reservoir.wells()[0]\n    samples = plate.rows()[0][0]\n    dnase = tuberack.wells_by_name()['A4']\n\n    '''\n    water_well = reservoir.wells_by_name()['A2']\n\n    qubit_sample_wells = qubit_sample_plate.wells()[0:num_samples]\n    norm_destination_wells = normalization_plate.wells()[0:num_samples]\n    # plate, tube rack maps\n\n    '''\n    Define any plate or tube maps here.\n\n    e.g.\n\n    plate_wells_by_row = [well for row in plate.rows() for well in row]\n\n    '''\n\n    # protocol\n\n    '''\n\n    Include header sections as follows for each \"section\" of your protocol.\n\n    Section can be defined as a step in a bench protocol.\n\n    e.g.\n\n    ctx.comment('\\n\\nMOVING MASTERMIX TO SAMPLES IN COLUMNS 1-6\\n')\n\n    for .... in ...:\n        ...\n        ...\n\n    ctx.comment('\\n\\nRUNNING THERMOCYCLER PROFILE\\n')\n\n    ...\n    ...\n    ...\n\n\n    '''\n    # Load CSV into a Nx2 list of lists (LoL) (well, concentration [ng/\u00b5L])\n    # Start by splitting by newline to get the rows\n    csv_rows = normalization_csv.split(\"\\n\")\n    norm_LoL = [[] for _ in range(num_samples+1)]  # +1 row for header\n    for csv_row, norm_lol_row in zip(csv_rows[0:num_samples+1], norm_LoL):\n        for cell in csv_row.split(\",\"):\n            norm_lol_row.append(cell)\n\n    #  Find the min value in the LoL\n    def key_func_norm_row(row):\n        return row[1]\n\n    min_conc = float(min(norm_LoL, key=key_func_norm_row)[1])\n\n    ctx.comment(\"\\n\\nNormalizing DNA sample's concentration\")\n    for s_well, d_well, norm_LoL_row in zip(qubit_sample_wells,\n                                            norm_destination_wells,\n                                            norm_LoL[1:]):\n        sample_vol = 10*(min_conc/float(norm_LoL_row[1]))\n        water_vol = 10 - sample_vol\n        p20.transfer(sample_vol, s_well, d_well)\n        p20.transfer(water_vol, water_well, d_well)\n\n    ctx.comment(\"\\n\\n~~~ End of protocol part 5 ~~~\")\n",
    "custom_labware_defs": [],
    "fields": [
        {
            "default": "well,concentration\n1,3.6\n2,3.63\n3,5.86\n4,1.75\n5,1.19\n6,2.77\n7,1.63\n8,5.16\n9,5.63\n10,1.62\n11,1.78\n12,4.56\n13,1.6\n14,1.7\n15,1.32\n16,2.93\n17,1.27\n18,1.03\n19,4.62\n20,3.67\n21,1.35\n22,3.74\n23,5.51\n24,4.06\n25,4.66\n26,4.65\n27,2.18\n28,3.65\n29,3.03\n30,1.37\n31,4.54\n32,5.5\n33,1.55\n34,3.26\n35,4.12\n36,2.54",
            "label": "Sample:concentration (ng/uL) Input CSV File",
            "name": "normalization_csv",
            "type": "textFile"
        },
        {
            "default": 36,
            "label": "Number of samples",
            "name": "num_samples",
            "type": "int"
        }
    ],
    "instruments": [
        {
            "mount": "left",
            "name": "p20_single_gen2"
        },
        {
            "mount": "right",
            "name": "p300_single_gen2"
        }
    ],
    "labware": [
        {
            "name": "quantification plate on 1",
            "share": false,
            "slot": "1",
            "type": "nest_96_wellplate_100ul_pcr_full_skirt"
        },
        {
            "name": "quantification plate on 2",
            "share": false,
            "slot": "2",
            "type": "nest_96_wellplate_100ul_pcr_full_skirt"
        },
        {
            "name": "Magnetic module sample plate on Magnetic Module GEN2 on 3",
            "share": false,
            "slot": "3",
            "type": "nest_96_wellplate_100ul_pcr_full_skirt"
        },
        {
            "name": "Normalization plate on 4",
            "share": false,
            "slot": "4",
            "type": "nest_96_wellplate_100ul_pcr_full_skirt"
        },
        {
            "name": "Opentrons 96 Filter Tip Rack 200 \u00b5L on 5",
            "share": false,
            "slot": "5",
            "type": "opentrons_96_filtertiprack_200ul"
        },
        {
            "name": "Reagent reservoir on 6",
            "share": false,
            "slot": "6",
            "type": "nest_12_reservoir_15ml"
        },
        {
            "name": "Opentrons 96 Filter Tip Rack 200 \u00b5L on 8",
            "share": false,
            "slot": "8",
            "type": "opentrons_96_filtertiprack_200ul"
        },
        {
            "name": "Magnetic bead plate on 9",
            "share": false,
            "slot": "9",
            "type": "nest_96_wellplate_100ul_pcr_full_skirt"
        },
        {
            "name": "Opentrons 96 Filter Tip Rack 20 \u00b5L on 10",
            "share": false,
            "slot": "10",
            "type": "opentrons_96_filtertiprack_20ul"
        },
        {
            "name": "Opentrons 96 Filter Tip Rack 20 \u00b5L on 11",
            "share": false,
            "slot": "11",
            "type": "opentrons_96_filtertiprack_20ul"
        },
        {
            "name": "Opentrons Fixed Trash on 12",
            "share": false,
            "slot": "12",
            "type": "opentrons_1_trash_1100ml_fixed"
        }
    ],
    "metadata": {
        "apiLevel": "2.11",
        "author": "Eskil Andersen <eskil.andersen@opentrons.com>",
        "description": "Normalization protocol",
        "protocolName": "466f93-5 - Automated LifeCell_NIPT_35Plex_HV",
        "source": "Custom Protocol Request"
    },
    "modules": []
}