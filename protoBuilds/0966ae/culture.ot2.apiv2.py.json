{
    "content": "metadata = {\n    'protocolName': '384-Well Plate Prep',\n    'author': 'Nick Diehl <ndiehl@opentrons.com>',\n    'apiLevel': '2.13'\n}\n\n\ndef run(ctx):\n\n    [num_plates, do_day1, do_day2, mount_p300] = get_values(  # noqa: F821\n        'num_plates', 'do_day1', 'do_day2', 'mount_p300')\n\n    tiprack300 = [ctx.load_labware('opentrons_96_tiprack_300ul', '1')]\n    tuberack = ctx.load_labware(\n        'opentrons_24_tuberack_eppendorf_2ml_safelock_snapcap', '2')\n    plates384 = [\n        ctx.load_labware('corning_384_wellplate_112ul_flat', slot,\n                         f'plate {i+1}')\n        for i, slot in enumerate(range(3, 3+num_plates))]\n\n    p300 = ctx.load_instrument('p300_single_gen2',\n                               mount_p300,\n                               tip_racks=tiprack300)\n\n    # reagents\n    coating_solution = tuberack.wells()[0]\n    water = tuberack.wells()[1]\n    waste = ctx.loaded_labwares[12].wells()[0]\n    vol_coating_solution = 100.0\n    vol_water1 = 100.0\n    vol_water2 = 100.0\n\n    def slow_withdraw(well, delay_seconds=2.0, pip=p300):\n        pip.default_speed /= 16\n        if delay_seconds > 0:\n            ctx.delay(seconds=delay_seconds)\n        pip.move_to(well.top())\n        pip.default_speed *= 16\n\n    def custom_transfer(vol,\n                        source,\n                        destination,\n                        vol_pre_airgap=10,\n                        h_asp=1.0,\n                        h_disp=1.0,\n                        blow_out=False,\n                        pip=p300):\n        if vol_pre_airgap > 0:\n            pip.aspirate(vol_pre_airgap, source.top())\n        p300.aspirate(vol, source.bottom(h_asp))\n        slow_withdraw(source)\n        p300.dispense(p300.current_volume, destination.bottom(h_disp))\n        if blow_out:\n            pip.blow_out(destination.bottom(h_disp))\n        slow_withdraw(destination)\n\n    \"\"\" DAY 1 \"\"\"\n    if do_day1:\n        dests1 = [\n            well for plate in plates384\n            for row in [\n                plate.rows_by_name()[row_name] for row_name in 'CEFHIKLN']\n            for well in row[3::3]]\n        p300.pick_up_tip()\n        for d in dests1:\n            custom_transfer(vol_coating_solution, coating_solution, d)\n        p300.drop_tip()\n\n    \"\"\" DAY 2 \"\"\"\n    if do_day2:\n        sources2 = [\n            well for plate in plates384\n            for row in [\n                plate.rows_by_name()[row_name] for row_name in 'CEFHIKLN']\n            for well in row[1:-1:2]]\n        p300.pick_up_tip()\n        for s in sources2:\n            custom_transfer(vol_coating_solution, s, waste, h_asp=0.2,\n                            h_disp=30, vol_pre_airgap=20, blow_out=True)\n        p300.drop_tip()\n\n        dests3 = [\n            well for plate in plates384\n            for row in [plate.rows_by_name()[row_name] for row_name in 'CFIL']\n            for well in row[3::3]]\n        p300.pick_up_tip()\n        for d in dests3:\n            custom_transfer(vol_water1, water, d)\n        p300.drop_tip()\n\n        ctx.delay(minutes=10)\n\n        dests4 = [\n            well for plate in plates384\n            for row in [plate.rows_by_name()[row_name] for row_name in 'DHKN']\n            for well in row[3::3]]\n        p300.pick_up_tip()\n        for d in dests4:\n            custom_transfer(vol_water1, water, d)\n        p300.drop_tip()\n\n        ctx.delay(minutes=10)\n\n        sources5 = [\n            well for plate in plates384\n            for row in [\n                plate.rows_by_name()[row_name] for row_name in 'CEFHIKLN']\n            for well in row[1:-1:2]]\n        p300.pick_up_tip()\n        for s in sources5:\n            custom_transfer(vol_water1, s, waste, h_asp=0.2,\n                            h_disp=30, vol_pre_airgap=20, blow_out=True)\n        p300.drop_tip()\n\n        dests6 = [\n            well for plate in plates384\n            for row in [plate.rows_by_name()[row_name] for row_name in 'CFIL']\n            for well in row[1:-3:3]]\n        p300.pick_up_tip()\n        for d in dests6:\n            custom_transfer(vol_water2, water, d)\n        p300.drop_tip()\n\n        ctx.delay(minutes=10)\n\n        dests7 = [\n            well for plate in plates384\n            for row in [plate.rows_by_name()[row_name] for row_name in 'EHKN']\n            for well in row[1:-3:3]]\n        p300.pick_up_tip()\n        for d in dests7:\n            custom_transfer(vol_water2, water, d)\n        p300.drop_tip()\n\n        sources8 = sources5\n        p300.pick_up_tip()\n        for s in sources8:\n            custom_transfer(vol_water2, s, waste, h_asp=0.2,\n                            h_disp=30, vol_pre_airgap=20, blow_out=True)\n        p300.drop_tip()\n\n        dests9 = dests3\n        p300.pick_up_tip()\n        for d in dests9:\n            custom_transfer(vol_water1, water, d)\n        p300.drop_tip()\n\n        ctx.delay(minutes=10)\n\n        dests10 = dests4\n        p300.pick_up_tip()\n        for d in dests10:\n            custom_transfer(vol_water1, water, d)\n        p300.drop_tip()\n\n        ctx.delay(minutes=10)\n\n        sources11 = sources8\n        p300.pick_up_tip()\n        for s in sources11:\n            custom_transfer(vol_water2+20, s, waste, h_asp=0.2,\n                            h_disp=30, vol_pre_airgap=20, blow_out=True)\n        p300.drop_tip()\n",
    "custom_labware_defs": [],
    "fields": [
        {
            "default": 9,
            "label": "number of plates (1-9)",
            "name": "num_plates",
            "type": "int"
        },
        {
            "label": "perform day 1 steps",
            "name": "do_day1",
            "options": [
                {
                    "label": "yes",
                    "value": true
                },
                {
                    "label": "no",
                    "value": false
                }
            ],
            "type": "dropDown"
        },
        {
            "label": "perform day 2 steps",
            "name": "do_day2",
            "options": [
                {
                    "label": "yes",
                    "value": true
                },
                {
                    "label": "no",
                    "value": false
                }
            ],
            "type": "dropDown"
        },
        {
            "label": "P300 GEN2 single-channel pipette mount",
            "name": "mount_p300",
            "options": [
                {
                    "label": "left",
                    "value": "left"
                },
                {
                    "label": "right",
                    "value": "right"
                }
            ],
            "type": "dropDown"
        }
    ],
    "instruments": [
        {
            "mount": "left",
            "name": "p300_single_gen2"
        }
    ],
    "labware": [
        {
            "name": "Opentrons 96 Tip Rack 300 \u00b5L on 1",
            "share": false,
            "slot": "1",
            "type": "opentrons_96_tiprack_300ul"
        },
        {
            "name": "Opentrons 24 Tube Rack with Eppendorf 2 mL Safe-Lock Snapcap on 2",
            "share": false,
            "slot": "2",
            "type": "opentrons_24_tuberack_eppendorf_2ml_safelock_snapcap"
        },
        {
            "name": "plate 1 on 3",
            "share": false,
            "slot": "3",
            "type": "corning_384_wellplate_112ul_flat"
        },
        {
            "name": "plate 2 on 4",
            "share": false,
            "slot": "4",
            "type": "corning_384_wellplate_112ul_flat"
        },
        {
            "name": "plate 3 on 5",
            "share": false,
            "slot": "5",
            "type": "corning_384_wellplate_112ul_flat"
        },
        {
            "name": "plate 4 on 6",
            "share": false,
            "slot": "6",
            "type": "corning_384_wellplate_112ul_flat"
        },
        {
            "name": "plate 5 on 7",
            "share": false,
            "slot": "7",
            "type": "corning_384_wellplate_112ul_flat"
        },
        {
            "name": "plate 6 on 8",
            "share": false,
            "slot": "8",
            "type": "corning_384_wellplate_112ul_flat"
        },
        {
            "name": "plate 7 on 9",
            "share": false,
            "slot": "9",
            "type": "corning_384_wellplate_112ul_flat"
        },
        {
            "name": "plate 8 on 10",
            "share": false,
            "slot": "10",
            "type": "corning_384_wellplate_112ul_flat"
        },
        {
            "name": "plate 9 on 11",
            "share": false,
            "slot": "11",
            "type": "corning_384_wellplate_112ul_flat"
        },
        {
            "name": "Opentrons Fixed Trash on 12",
            "share": false,
            "slot": "12",
            "type": "opentrons_1_trash_1100ml_fixed"
        }
    ],
    "metadata": {
        "apiLevel": "2.13",
        "author": "Nick Diehl <ndiehl@opentrons.com>",
        "protocolName": "384-Well Plate Prep"
    },
    "modules": []
}