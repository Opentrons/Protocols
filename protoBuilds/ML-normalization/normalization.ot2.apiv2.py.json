{
    "content": "# metadata\nmetadata = {\n    'protocolName': 'Normalization from .csv',\n    'author': 'Nick <protocols@opentrons.com>',\n    'source': 'Custom Protocol Request',\n    'apiLevel': '2.0'\n}\n\n\ndef run(ctx):\n\n    [input_csv, p10_mount, p50_mount] = get_values(  # noqa: F821\n        'input_csv', 'p10_mount', 'p50_mount')\n    # [input_csv, p10_mount, p50_mount] = [\n    #     \"source plate well, destination plate well, volume sample (\u00b5l),\\\n    #     volume diluent (\u00b5l)\\nA1, A1, 2, 28\", 'right', 'left'\n    # ]\n\n    # labware\n    source_plate = ctx.load_labware(\n        'biorad_96_wellplate_200ul_pcr', '1', 'source plate')\n    destination_plate = ctx.load_labware(\n        'biorad_96_wellplate_200ul_pcr', '2', 'destination plate')\n    tiprack10 = [\n        ctx.load_labware('opentrons_96_tiprack_10ul', slot, '10ul tiprack')\n        for slot in ['3', '6']\n    ]\n    water = ctx.load_labware(\n        'usascientific_12_reservoir_22ml', '5',\n        'reservoir for water (channel 1)').wells()[0].bottom(5)\n    tiprack50 = [\n        ctx.load_labware('opentrons_96_tiprack_300ul', slot, '300ul tiprack')\n        for slot in ['8', '9']\n    ]\n\n    # pipettes\n    p10 = ctx.load_instrument(\n        'p10_single', p10_mount, tip_racks=tiprack10)\n    p50 = ctx.load_instrument(\n        'p50_single', p50_mount, tip_racks=tiprack50)\n\n    # parse\n    sources = [\n        source_plate.wells_by_name()[line.split(',')[0].strip().upper()]\n        for line in input_csv.splitlines()[1:] if line\n    ]\n    dests = [\n        destination_plate.wells_by_name()[line.split(',')[1].strip().upper()]\n        for line in input_csv.splitlines()[1:] if line\n    ]\n    vols_sample = [\n        float(line.split(',')[2])\n        for line in input_csv.splitlines()[1:] if line\n    ]\n    vols_water = [\n        float(line.split(',')[3])\n        for line in input_csv.splitlines()[1:] if line\n    ]\n\n    # perform normalization\n    for s, d, vol_s, vol_w in zip(sources, dests, vols_sample, vols_water):\n        # pre-transfer diluent\n        pip = p50 if vol_w > 10 else p10\n        pip.pick_up_tip()\n        pip.transfer(vol_w, water, d.bottom(2), new_tip='never')\n        pip.blow_out(d.top(-2))\n\n        # transfer sample\n        pip = p50 if vol_s > 10 else p10\n        if not pip.hw_pipette['has_tip']:\n            pip.pick_up_tip()\n        pip.transfer(vol_s, s, d, mix_after=(5, 10), new_tip='never')\n        pip.blow_out(d.top(-2))\n        for p in [p10, p50]:\n            if p.hw_pipette['has_tip']:\n                p.drop_tip()\n",
    "custom_labware_defs": [],
    "fields": [
        {
            "default": "source plate well,destination plate well,volume sample (\u00b5l),volume diluent (\u00b5l)\nA1,A1,2,28",
            "label": ".csv input file",
            "name": "input_csv",
            "type": "textFile"
        },
        {
            "label": "P10 GEN1 single-channel mount",
            "name": "p10_mount",
            "options": [
                {
                    "label": "right",
                    "value": "right"
                },
                {
                    "label": "left",
                    "value": "left"
                }
            ],
            "type": "dropDown"
        },
        {
            "label": "P50 GEN1 single-channel mount",
            "name": "p50_mount",
            "options": [
                {
                    "label": "left",
                    "value": "left"
                },
                {
                    "label": "right",
                    "value": "right"
                }
            ],
            "type": "dropDown"
        }
    ],
    "instruments": [
        {
            "mount": "left",
            "name": "p50_single"
        },
        {
            "mount": "right",
            "name": "p10_single"
        }
    ],
    "labware": [
        {
            "name": "source plate on 1",
            "share": false,
            "slot": "1",
            "type": "biorad_96_wellplate_200ul_pcr"
        },
        {
            "name": "destination plate on 2",
            "share": false,
            "slot": "2",
            "type": "biorad_96_wellplate_200ul_pcr"
        },
        {
            "name": "10ul tiprack on 3",
            "share": false,
            "slot": "3",
            "type": "opentrons_96_tiprack_10ul"
        },
        {
            "name": "reservoir for water (channel 1) on 5",
            "share": false,
            "slot": "5",
            "type": "usascientific_12_reservoir_22ml"
        },
        {
            "name": "10ul tiprack on 6",
            "share": false,
            "slot": "6",
            "type": "opentrons_96_tiprack_10ul"
        },
        {
            "name": "300ul tiprack on 8",
            "share": false,
            "slot": "8",
            "type": "opentrons_96_tiprack_300ul"
        },
        {
            "name": "300ul tiprack on 9",
            "share": false,
            "slot": "9",
            "type": "opentrons_96_tiprack_300ul"
        },
        {
            "name": "Opentrons Fixed Trash on 12",
            "share": false,
            "slot": "12",
            "type": "opentrons_1_trash_1100ml_fixed"
        }
    ],
    "metadata": {
        "apiLevel": "2.0",
        "author": "Nick <protocols@opentrons.com>",
        "protocolName": "Normalization from .csv",
        "source": "Custom Protocol Request"
    },
    "modules": []
}