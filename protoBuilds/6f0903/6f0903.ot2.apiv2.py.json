{
    "content": "from opentrons import protocol_api\nfrom typing import List\nfrom opentrons.protocol_api.labware import Well\nfrom opentrons.types import Point\n\nmetadata = {\n    'protocolName': 'MethylPatch Protocol for Opentrons OT-2',\n    'author': 'Eskil Andersen <eskil.andersen@opentrons.com>',\n    'source': 'Custom Protocol Request',\n    'apiLevel': '2.11'\n}\n\n\ndef run(ctx: protocol_api.ProtocolContext):\n\n    [p20_mount,\n     barcode_tube_init_vol,\n     mag_engage_height,\n     num_mix_repns,\n     is_flash_lights] = get_values(  # noqa: F821\n     \"p20_mount\",\n     \"barcode_tube_init_vol\",\n     \"mag_engage_height\",\n     \"num_mix_repns\",\n     \"is_flash_lights\")\n\n    p300_mount = 'right' if p20_mount == 'left' else 'left'\n\n    # load modules\n\n    '''\n\n    Add your modules here with:\n\n    module_name = ctx.load_module('{module_loadname}', '{slot number}')\n\n    Note: if you are loading a thermocycler, you do not need to specify\n    a slot number - thermocyclers will always occupy slots 7, 8, 10, and 11.\n\n    For all other modules, you can load them on slots 1, 3, 4, 6, 7, 9, 10.\n\n    '''\n    # The Thermocycler has a default position that\n    # covers Slots 7, 8, 10, and 11.\n    tc_mod = ctx.load_module('thermocycler module')\n    mag_mod = ctx.load_module('magnetic module gen2', '4')\n    temp_mod = ctx.load_module('temperature module gen2', '1')\n\n    # load labware\n\n    resv = ctx.load_labware('nest_12_reservoir_15ml', '9')\n    tc_plate = tc_mod.load_labware('nest_96_wellplate_200ul_flat')\n    mag_plate = mag_mod.load_labware('nest_96_wellplate_200ul_flat')\n    tmod_tubes = temp_mod.load_labware(\n        'opentrons_24_aluminumblock_nest_1.5ml_snapcap')\n\n    # load tipracks\n\n    tiprack20 = [ctx.load_labware('opentrons_96_filtertiprack_20ul', '2')]\n    tiprack200s = [\n        ctx.load_labware('opentrons_96_filtertiprack_200ul', '5', '6')]\n\n    # load instrument\n\n    p20 = ctx.load_instrument(\n                              'p20_single_gen2',\n                              p20_mount,\n                              tip_racks=tiprack20\n                              )\n\n    p300 = ctx.load_instrument(\n                              'p300_multi_gen2',\n                              p300_mount,\n                              tip_racks=tiprack200s\n                              )\n\n    # pipette functions   # INCLUDE ANY BINDING TO CLASS\n    def pick_up(pipette):\n        \"\"\"`pick_up()` will pause the protocol when all tip boxes are out of\n        tips, prompting the user to replace all tip racks. Once tipracks are\n        reset, the protocol will start picking up tips from the first tip\n        box as defined in the slot order when assigning the labware definition\n        for that tip box. `pick_up()` will track tips for both pipettes if\n        applicable.\n\n        :param pipette: The pipette desired to pick up tip\n        as definited earlier in the protocol (e.g. p300, m20).\n        \"\"\"\n        try:\n            pipette.pick_up_tip()\n        except protocol_api.labware.OutOfTipsError:\n            ctx.pause(\"Replace empty tip racks\")\n            pipette.reset_tipracks()\n            pipette.pick_up_tip()\n\n    # helper functions\n    # Keep track of how much waste we have generated so that the waste well\n    # does not overflow\n    waste_vol = 0\n\n    def bead_cleanup(\n            mix_vol: float,\n            bead_vol: float,\n            dna_vol: float,\n            DNA_source_col: List[Well],\n            mag_target_col: List[Well],\n            dna_air_gap_vol: float,\n            supernatant_vol: float,\n            resusp_water_vol: float,\n            water_column: List[Well],\n            purified_DNA_vol: float,\n            purified_dna_target_col: List[Well]):\n        \"\"\"\n        This function transfers samples from a given DNA sample source column\n        (on the thermocycler plate) to the magnetic module plate and performs\n        an AMPure bead cleanup of the DNA. After the DNA has been cleaned it\n        is transferred to a new column on the thermocycler plate. Reservoir\n        well 1 contains beads and reservoir well 5 contains 80 % ethanol.\n\n        :param mix_vol: The mixing volume for each tip of the 8-channel p300\n        for mixing the bead well on the reservoir\n        :param bead_vol: The volume of beads to use for the cleanup.\n        :param dna_vol: The volume of DNA sample to transfer from the TC plate\n        to the mag mod plate.\n        :param mag_target_col: The magnetic plate column to dispense the\n        DNA samples in for cleanup.\n        :param dna_air_gap_vol: Air gap volume in \u00b5L for the DNA sample transfr\n        :param supernatant_vol: The volume of supernatant to remove from the\n        well after the beads have bound the DNA. The supernatant is transferred\n        to either the last or penultimate well of the reservoir as trash.\n        :param resusp_water_vol: The volume of water to resuspend the cleaned\n        DNA in.\n        :param water_column: The column on the thermocycler from which to\n        aspirate water from for the resuspension.\n        :param purified_DNA_vol: The volume of purified DNA to transfer back\n        to the TC plate.\n        :param purified_dna_target_col: The column (on the TC plate) to\n        transfer the purified DNA to.\n        \"\"\"\n\n        nonlocal p300, ctx, mag_beads, mag_mod, waste_wells\n        nonlocal ethanol_well, waste_vol\n        mag_well = mag_target_col[0]\n        well_radius = mag_well.diameter/2\n        # Left and right locations 1 mm from the bottom and 1 mm from the side\n        # of the well.\n        mag_well_left_locn = mag_well.bottom(1).move(\n            Point(-well_radius-1, 0, 0))\n        mag_well_right_locn = mag_well.bottom(1).move(\n            Point(well_radius-1, 0, 0))\n        ctx.comment(\"\\nMixing and transferring AMPure beads\\n\")\n        # 1. Use 8-channel P300 to mix Reservoir Well 1\n        # (Ampure Beads - High Viscosity).\n        pick_up(p300)\n        p300.mix(num_mix_repns, mix_vol, mag_beads, rate=0.3)\n        # 2. Transfer <bead_vol> uL of Reservoir Well 1 to\n        # Magnet Wells Column <n> A-H.\n        p300.aspirate(bead_vol, mag_beads, rate=0.3)\n        p300.dispense(bead_vol, mag_well, rate=0.3)\n        # Solution is viscous, try to get it all out\n        p300.touch_tip()\n        p300.blow_out()\n        # 3. Transfer <dna_vol> uL of Thermocycler Column <n> A-H to\n        # Magnet Wells Column <n> A-H.\n        ctx.comment(\n            \"\\nTransferring DNA samples from the thermocycler to the magnetic \"\n            \"module\\n\")\n        p300.aspirate(dna_vol, DNA_source_col[0])\n        p300.air_gap(dna_air_gap_vol)\n        p300.dispense(dna_vol+dna_air_gap_vol, mag_well)\n        # 4. Mix Magnet Wells Column 1 A-H at 1 minute intervals for 10 minutes\n        # Total volume in the mag column: bead_vol + dna_vol\n        mix_vol = bead_vol + dna_vol - 20\n        mix_vol = mix_vol if mix_vol < 200 else 200\n        mix_vol = mix_vol if mix_vol > 5 else (bead_vol + dna_vol)/2\n        if mix_vol < 0:\n            raise Exception(\n                \"The mixing vol for step 4. in the bead cleanup function \"\n                f\" is less than 0 uL ({mix_vol})\")\n        mix_vol = mix_vol if mix_vol < 200 else 200\n        for i in range(10):\n            p300.mix(num_mix_repns, mix_vol, mag_well, rate=1)\n            ctx.delay(minutes=1)\n        p300.touch_tip()\n        p300.blow_out()\n        # 5. Engage magnet.\n        mag_mod.engage(height_from_base=mag_engage_height)\n        # 6. Hold for 5 minutes\n        ctx.delay(minutes=5)\n        # 7. remove <supernatant_vol> from Magnet Wells Column 1 A-H.\n        # The magnetic pellet is on the right, so aspirate supernatant\n        # from the left so the pellet is not disturbed\n        ctx.comment(\"\\nRemoving supernatant from beads\\n\")\n        p300.aspirate(supernatant_vol, mag_well_left_locn, rate=0.2)\n        supernatant_air_gap_vol = 10 if supernatant_vol < 190 \\\n            else 200 - supernatant_vol\n        if supernatant_air_gap_vol > 0:\n            p300.air_gap(supernatant_air_gap_vol)\n        p300.dispense(\n            supernatant_vol+supernatant_air_gap_vol, waste_wells[-1].top())\n        waste_vol += supernatant_vol * 8\n        if waste_vol > 12_000:\n            waste_wells.pop()\n            waste_vol = 0\n        # 400*8*4 uL of ethanol=12.8 mL\n        # Supernatant volumes to waste: (111 + 151 + 150*2)*8 = 4.5 mL\n        # Total waste volume: 12.8 mL + 4.5 = 17.3 mL for the entire ptcl.\n        p300.blow_out()\n        # 8. Discard tips.\n        p300.drop_tip()\n        # 9. Use 8-channel P300 to mix Reservoir Well 5\n        # (80% EtOH -low viscosity)\n        pick_up(p300)\n        ctx.comment(\"\\nPerforming first 80 % ethanol wash\\n\")\n        p300.mix(num_mix_repns, 200, ethanol_well)\n        # 10. Transfer 200 uL of Reservoir Well 5 to Magnet Wells Column 1 A-H.\n        p300.aspirate(200, ethanol_well)\n        p300.dispense(200, mag_well, rate=0.2)\n        # 11. Slowly mix Magnet Wells Column 1 A-H 10 times.\n        # (Magnet still engaged, washing bead pellet).\n        p300.mix(num_mix_repns, 200, mag_well, rate=0.2)\n        # 12. Remove 200 uL from Magnet Wells Column 1 A-H.\n        p300.aspirate(200, mag_well_left_locn, rate=0.2)\n        p300.dispense(200, waste_wells[-1].top())\n        waste_vol += 200 * 8\n        if waste_vol > 12_000:\n            waste_wells.pop()\n            waste_vol = 0\n        p300.blow_out()\n        # 13. Discard tips\n        p300.drop_tip()\n        # 14. Use 8-channel P300 to mix Reservoir Well 5\n        # (80% EtOH -low viscosity)\n        ctx.comment(\"\\nPerforming second 80 % ethanol wash\\n\")\n        pick_up(p300)\n        p300.mix(num_mix_repns, 200, ethanol_well)\n        # 15. Transfer 200 uL of Reservoir Well 5 to Magnet Wells Column 1 A-H.\n        p300.aspirate(200, ethanol_well)\n        p300.dispense(200, mag_well, rate=0.2)\n        # 16. Slowly mix Magnet Wells Column 1 A-H 10 times.\n        # (Magnet still engaged, washing bead pellet).\n        p300.mix(num_mix_repns, 200, mag_well, rate=0.2)\n        # 17 Remove 200 uL from Magnet Wells Column 1 A-H away from pellet.\n        p300.aspirate(200, mag_well_left_locn, rate=0.2)\n        p300.dispense(200, waste_wells[-1].top())\n        waste_vol += 200 * 8\n        if waste_vol > 12_000:\n            waste_wells.pop()\n            waste_vol = 0\n        p300.blow_out()\n        # 18 Discard tips. 24 tips used total\n        p300.drop_tip()\n        # 19 Hold for 10 minutes (magnet still engaged)\n        #    to let residual ethanol evaporate.\n        ctx.delay(minutes=10)\n        # 20 Close thermocycler lid.\n        tc_mod.close_lid()\n        # 21 Heat thermocycler to 37C for 2 minutes\n        # tc_mod.set_lid_temperature(98) - assume that the lid temperature\n        # has been set already.\n        ctx.comment(\"\\nIncubating and resuspending cleaned DNA\\n\")\n        tc_mod.set_block_temperature(37, hold_time_minutes=2)\n        # 22 Open thermocycler lid.\n        tc_mod.open_lid()\n        # 23 Disengage magnet.\n        mag_mod.disengage()\n        # 24 Use 8-channel P300 to transfer 30 uL of water from\n        #    Thermocycler Column 9 Rows A-H to Magnet Wells Column 1 A-H.\n        #    Dispense liquid over the side of the tube with the magnetic\n        #    contact.\n        pick_up(p300)\n        p300.aspirate(resusp_water_vol, water_column[0])\n        p300.dispense(resusp_water_vol, mag_well_right_locn)\n        # 25 Mix Magnet Wells Column 1 A-H at 1 minute intervals for\n        #    10 minutes (eluting DNA from beads).\n        for i in range(10):\n            p300.mix(\n                num_mix_repns, resusp_water_vol-5, mag_well_right_locn, rate=1)\n            ctx.delay(minutes=1)\n        p300.touch_tip()\n        p300.blow_out(mag_well.top())\n        # 26 Engage magnet.\n        mag_mod.engage(height_from_base=mag_engage_height)\n        # 27 Hold for 3 minutes (magnet still engaged).\n        ctx.delay(minutes=3)\n        # 28 Transfer <x> uL from Magnet Wells Column 1 A-H to Thermocycler\n        #    Column <n> Rows A-H. Aspirate away from the bead pellet\n        #    i.e. aspirate from the left side of the well.\n        ctx.comment(\n            \"\\nTransferring cleaned DNA back to the thermocycler plate\\n\")\n        p300.aspirate(purified_DNA_vol, mag_well_left_locn)\n        p300.dispense(purified_DNA_vol, purified_dna_target_col[0])\n        # 29 Discard tips. 32 tips used\n        p300.drop_tip()\n        # 30 Disengage magnet.\n        mag_mod.disengage()\n\n    def transfer_reagent(\n            dna_sample_column: List[Well],\n            reagent: Well,\n            reag_vol: float,\n            well_mixing_vol: float,\n            reagent_mix: bool = True):\n        \"\"\"\n        This function is used to transfer a reagent from a tube on the\n        temperature module to wells on the plate in the thermocycler.\n        :param dna_sample_column: The column containing the target wells\n        :param reagent: The reagent tube\n        :param reag_vol: How much reagent volume to dispense into each\n        target well.\n        :param well_mixing_vol: Mixing volume for mixing the target well\n        after the reagent has been added.\n        :param reagent_mix: Whether to mix the reagent or not before dispensing\n        it in the target well.\n        \"\"\"\n        nonlocal p20\n        num_wells = len(dna_sample_column)\n        # Repeat for the entire column\n        for i, well in enumerate(dna_sample_column):\n            # 1. Use the p20 to mix the reagent tube\n            pick_up(p20)\n            # All reagents get mixed in this protocol except for water\n            # The flag allows us to skip mixing in that case\n            if reagent_mix:\n                remaining_reagent_vol = (num_wells - i) * reag_vol\n                mix_vol = remaining_reagent_vol if remaining_reagent_vol < 20 \\\n                    else 20\n                p20.mix(num_mix_repns, mix_vol, reagent)\n            # 2. Transfer x uL of the reagent tube to the target well\n            p20.aspirate(10, reagent, rate=0.5)\n            p20.dispense(10, well, rate=0.5)\n            p20.touch_tip()\n            # 3. Mix the target well\n            p20.mix(num_mix_repns, well_mixing_vol, well)\n            # 4. Drop the tip\n            p20.drop_tip()\n\n    # reagents & samples\n\n    # DNA samples are moved to a fresh column after each bead cleanup\n    # The exception is the 5th sample column which contained water previously\n    DNA_initial_col = tc_plate.columns()[0]   # 1st sample col = 1st plate col\n    DNA_target_col_1 = tc_plate.columns()[2]  # 2nd sample col = 3rd plate col\n    DNA_target_col_2 = tc_plate.columns()[4]  # 3rd sample col = 5th plate col\n    DNA_target_col_3 = tc_plate.columns()[6]  # 4th sample col = 7th plate col\n    DNA_target_col_4 = tc_plate.columns()[8]  # 5th sample col = 9th plate col\n\n    mag_target_col_1 = mag_plate.columns()[0]  # 1st sample cleanup column = 1\n    mag_target_col_2 = mag_plate.columns()[2]  # 2nd sample cleanup column = 3\n    mag_target_col_3 = mag_plate.columns()[4]  # 3rd sample cleanup column = 5\n    mag_target_col_4 = mag_plate.columns()[6]  # 4th sample cleanup column = 7\n\n    water_col_1_30ul = tc_plate.columns()[8]\n    water_col_2_17ul = tc_plate.columns()[9]\n    water_col_3_30ul = tc_plate.columns()[10]\n    water_col_4_42ul = tc_plate.columns()[11]\n\n    mag_beads = resv.wells_by_name()['A1']\n    ethanol_well = resv.wells_by_name()['A5']\n    waste_wells = resv.wells()[-2:]\n\n    digest_mix = tmod_tubes.wells()[0]  # Temperature Tube 1\n    patch_mix = tmod_tubes.wells()[1]  # Temperature Tube 2\n    exo_mix = tmod_tubes.wells()[2]  # Temperature Tube 3\n    TET2_mix = tmod_tubes.wells()[3]  # Temperature Tube 4\n    Fe_sol = tmod_tubes.wells()[4]  # Temperature Tube 5\n    stop_reagt = tmod_tubes.wells()[5]  # Temperature TUbe 6\n    NaOH = tmod_tubes.wells()[6]  # Temperature Tube 7\n    dH2O = tmod_tubes.wells()[7]  # Temperature Tube 8\n    APOBEC_mix = tmod_tubes.wells()[8]  # Temperature Tube 9\n    pcr_mix = tmod_tubes.wells()[9]  # Temperature Tube 10\n    barcodes = tmod_tubes.wells()[10:18]\n\n    # plate, tube rack maps\n\n    # protocol\n    temp_mod.set_temperature(4)\n\n    ctx.comment(\"\\n\\nStep 1: Restriction enzyme digestion of DNA\\n\")\n    # 1.1       Use P20 to mix Temperature Tube 1 (Digest Master Mix).\n    # 1.2       Transfer 10 uL of Temperature Tube 1 to Thermocycler Tube 1A.\n    # 1.3       Mix Thermocycler Tube A1.\n    # 1.4       Discard Tip.\n    # 1.5       Repeat steps 1.1 -1.4 for transfers from Temperature Tube 1\n    # cont.     to Thermocycler Tubes 1B,1C,1D,1E,1F,1G, 1H.\n    transfer_reagent(\n        dna_sample_column=DNA_initial_col,\n        reagent=digest_mix,\n        reag_vol=10,\n        well_mixing_vol=18)\n    # 1.6       Close lid.\n    tc_mod.close_lid()\n    # Set the lid temperature here and keep it throughout the protocol\n    tc_mod.set_lid_temperature(98)\n    # 1.7       Incubate at 37C for 60 minutes.\n    tc_mod.set_block_temperature(37, hold_time_minutes=60)\n    # 1.8       Incubate at 4C for 3 minutes.\n    tc_mod.set_block_temperature(4, hold_time_minutes=3)\n    # 1.9       Open lid.\n    tc_mod.open_lid()\n    # Total volume after step 1: initial DNA sample 10 uL + 10 uL digest\n    # master mix = 20 uL total\n\n    ctx.comment(\"\\n\\nStep 2: Patch ligation\\n\")\n    # 2.1       Use P20 to mix Temperature Tube 2 (Patch Master Mix).\n    # 2.2       Transfer 15 uL of Temperature Tube 2 to Thermocycler Tube 1A.\n    # 2.3       Mix Thermocycler Tube 1A.\n    # 2.4       Discard Tip.\n    # 2.5       Repeat steps 2.1 -2.4 for transfers from Temperature Tube 2\n    #           to Thermocycler Tubes 1B,1C,1D,1E,1F,1G, 1H.\n    transfer_reagent(\n        dna_sample_column=DNA_initial_col,\n        reagent=patch_mix,\n        reag_vol=15,\n        well_mixing_vol=20)\n    # 2.6       Close lid.\n    tc_mod.close_lid()\n    # 2.7       Cycle temperature: 94C for 30 seconds and 65 degrees for 4\n    #           minutes for 25 cycles.\n    # total volume: 20 + volume of patch master mix = 35 uL\n    patch_cycle_profile = [\n        {'temperature': 94, 'hold_time_seconds': 30},\n        {'temperature': 65, 'hold_time_minutes': 4}]\n    tc_mod.execute_profile(\n        steps=patch_cycle_profile, repetitions=25, block_max_volume=35)\n    # 2.8       Incubate at 4C for 3 minutes.\n    tc_mod.set_block_temperature(4, hold_time_minutes=3)\n    # 2.9       Open lid.\n    tc_mod.open_lid()\n\n    ctx.comment(\"\\n\\nStep 3: Exonuclease degradation\\n\")\n    # 3.1       Use P20 to mix Temperature Tube 3 (Exo Master Mix).\n    # 3.2       Transfer 2 uL of Temperature Tube 3 to Thermocycler Tube 1A.\n    #           total volume = 16 uL\n    # 3.3       Mix Thermocycler Tube A1.\n    # 3.4       Discard Tip.\n    # 3.5       Repeat steps 3.1 -3.4 for transfers from Temperature Tube 3\n    #           to Thermocycler Tubes B1, C1, D1, E1, F1, G1, H1.\n    transfer_reagent(\n        dna_sample_column=DNA_initial_col,\n        reagent=exo_mix,\n        reag_vol=2,\n        well_mixing_vol=20)\n    # 3.6       Close lid.\n    tc_mod.close_lid()\n    # 3.7       Incubate at 37C for 60 minutes.\n    tc_mod.set_block_temperature(37, hold_time_minutes=60)\n    # 3.8       Incubate at 4C for 3 minutes.\n    tc_mod.set_block_temperature(4, hold_time_minutes=3)\n    # 3.9       Open lid.\n    tc_mod.open_lid()\n\n    ctx.comment(\"\\n\\nStep 4: AMPure cleanup #1\\n\")\n\n    bead_cleanup(\n        mix_vol=200,\n        bead_vol=74,\n        dna_vol=37,\n        DNA_source_col=DNA_initial_col,\n        mag_target_col=mag_target_col_1,\n        dna_air_gap_vol=10,\n        supernatant_vol=111,\n        resusp_water_vol=30,\n        water_column=water_col_1_30ul,\n        purified_DNA_vol=28,\n        purified_dna_target_col=DNA_target_col_1)\n\n    ctx.comment(\"\\n\\nStep 5: TET2 Oxidation\\n\")\n\n    # 5.1      Use P20 to mix Temperature Tube 4 (TET2 Master Mix).\n    # 5.2      Transfer 17 uL of Temperature Tube 4 to Thermocycler Tube A3.\n    # 5.3      Mix Thermocycler Tube A3.\n    # 5.4      Discard Tip.\n    # 5.5      Repeat steps 5.1 -5.4 for transfers from Temperature Tube 4\n    #          to Thermocycler Tubes 3B,3C,3D,3E,3F,3G, 3H.\n    # Well volume: 28 + 17 = 45 uL\n    transfer_reagent(\n        dna_sample_column=DNA_target_col_1,\n        reagent=TET2_mix,\n        reag_vol=17,\n        well_mixing_vol=20)\n    # 5.6      Use P20 to mix Temperature Tube 5 (Fe solution).\n    # 5.7      Transfer 5 uL of Temperature Tube 5 to Thermocycler Tube A3.\n    # 5.8      Mix Thermocycler Tube 3A.\n    # 5.9      Discard Tip.\n    # 5.10     Repeat steps 5.6 -5.9 for transfers from Temperature Tube 5\n    #          to Thermocycler Tubes B3, C3, D3, E3, F3, G3, H3.\n    # Well volume: 45+5 = 50\n    transfer_reagent(\n        dna_sample_column=DNA_target_col_1,\n        reagent=Fe_sol,\n        reag_vol=5,\n        well_mixing_vol=20)\n    # 5.11     Close lid.\n    tc_mod.close_lid()\n    # 5.12     Incubate at 37C for 60 minutes.\n    tc_mod.set_block_temperature(37, hold_time_minutes=60)\n    # 5.13     Incubate at 25C for 3 minutes.\n    tc_mod.set_block_temperature(25, hold_time_minutes=3)\n    # 5.14     Open lid.\n    tc_mod.open_lid()\n    # 5.15     Use P20 to mix Temperature Tube 6 (Stop Reagent).\n    # 5.16     Transfer 1 uL of Temperature Tube 6 to Thermocycler Tube 3A.\n    # 5.17     Mix Thermocycler Tube 3A.\n    # 5.18     Discard Tip.\n    # 5.19     Repeat steps 5.15 -5.18 for transfers from Temperature Tube 6 to\n    #          Thermocycler Tubes 3B,3C,3D,3E,3F,3G, 3H.\n    transfer_reagent(\n        dna_sample_column=DNA_target_col_1,\n        reagent=stop_reagt,\n        reag_vol=1,\n        well_mixing_vol=20)\n    # 5.20     Close lid.\n    tc_mod.close_lid()\n    # 5.21     Incubate at 37C for 30 minutes.\n    tc_mod.set_block_temperature(37, hold_time_minutes=30)\n    # 5.22     Incubate at 4C for 3 minutes.\n    tc_mod.set_block_temperature(4, hold_time_minutes=3)\n    # 5.23     Open lid.\n    tc_mod.open_lid()\n\n    ctx.comment(\"\\n\\nStep 6: AMPure cleanup #2\\n\")\n    # 6.1 Use 8-channel P300 to mix Reservoir Well 1\n    #     (Ampure Beads - High Viscosity).\n    # 6.2 Transfer 100 uL of Reservoir Well 1 to Magnet Wells Column 3 A-H.\n    # 6.3 Transfer 51 uL of Thermocycler Column 3 A-H to Magnet Wells\n    #     Column 3 A-H.\n    # 6.4 Mix Magnet Wells Column 3 A-H at 1 minute intervals for 10 minutes.\n    # 6.5 Engage magnet.\n    # 6.6 Hold for 5 minutes (magnet still engaged).\n    # 6.7 Remove 151 uL from Magnet Wells Column 3 A-H.\n    # 6.8 Discard tips.\n    # 6.9 Use 8-channel P300 to mix Reservoir Well 5 (80% EtOH -low viscosity)\n    # 6.10 Transfer 200 uL of Reservoir Well 5 to Magnet Wells Column 3 A-H.\n    # 6.11 Slowly mix Magnet Wells Column 3 A-H 10 times.\n    #      (Magnet still engaged, washing bead pellet).\n    # 6.12 Remove 200 uL from Magnet Wells Column 3 A-H.\n    # 6.13 Discard tips.\n    # 6.14 Use 8-channel P300 to mix Reservoir Well 5 (80% EtOH -low viscosity)\n    # 6.15 Transfer 200 uL of Reservoir Well 5 to Magnet Wells Column 3 A-H.\n    # 6.16 Slowly mix Magnet Wells Column 3 A-H 10 times.\n    #      (Magnet still engaged, washing bead pellet).\n    # 6.17 Remove 200 uL from Magnet Wells Column 3 A-H.\n    # 6.18 Discard tips.\n    # 6.19 Hold for 10 minutes (magnet still engaged) to let\n    #      residual ethanol evaporate.\n    # 6.20 Close thermocycler lid.\n    # 6.21 Heat thermocycler to 37C for 2 minutes.\n    # 6.22 Open thermocycler lid.\n    # 6.23 Disengage magnet.\n    # 6.24 Use 8-channel P300 to transfer 17 uL of water from\n    #      Thermocycler Column 10 Rows A-H to Magnet Wells Column 3 A-H.\n    #      Dispense liquid over the side of the tube with the magnetic contact.\n    # 6.25 Mix Magnet Wells Column 3 A-H at 1 minute intervals for 10 minutes\n    #      (eluting DNA from beads).\n    # 6.26 Engage magnet.\n    # 6.27 Hold for 3 minutes (magnet still engaged).\n    # 6.28 Transfer 16uL from Magnet Wells Column 3 A-H to Thermocycler\n    #      Column 5 Rows A-H.\n    # 6.29 Discard tips.\n    # 6.30 Disengage magnet.\n    bead_cleanup(\n        mix_vol=200,\n        bead_vol=100,\n        dna_vol=51,\n        DNA_source_col=DNA_target_col_1,\n        mag_target_col=mag_target_col_2,\n        dna_air_gap_vol=10,\n        supernatant_vol=151,\n        resusp_water_vol=17,\n        water_column=water_col_2_17ul,\n        purified_DNA_vol=16,\n        purified_dna_target_col=DNA_target_col_2)\n\n    ctx.comment(\"\\n\\nStep 7: APOBEC Deamination\\n\")\n\n    # 7.1      Close thermocycler.\n    tc_mod.close_lid()\n    # 7.2      Incubate thermocycler at 50C for 3 minutes.\n    tc_mod.set_block_temperature(50, hold_time_minutes=3)\n    tc_mod.open_lid()\n    # 7.3      Use P20 to mix Temperature Tube 7 (NaOH).\n    # 7.4      Open thermocycler.\n    # 7.5      Transfer 4 uL of Temperature Tube 7 to Thermocycler Tube 5A.\n    # 7.6      Mix Thermocycler Tube 5A.\n    # 7.7      Discard Tip.\n    # 7.8      Repeat steps 7.5 -7.7 for transfers from Temperature Tube 7\n    #          to Thermocycler Tubes 5B,5C,5D,5E,5F,5G, 5H.\n    # Well volume: 16 + 4 = 20\n    transfer_reagent(\n        dna_sample_column=DNA_target_col_2,\n        reagent=NaOH,\n        reag_vol=4,\n        well_mixing_vol=18)\n    # 7.9      Close thermocycler.\n    tc_mod.close_lid()\n    # 7.10     Incubate at 50C for 10 minutes.\n    tc_mod.set_block_temperature(50, hold_time_minutes=10)\n    # 7.11     Incubate at 4C for 5 minutes.\n    tc_mod.set_block_temperature(4, hold_time_minutes=5)\n    # 7.12     Open thermocycler.\n    tc_mod.open_lid()\n    # 7.13     Use P20 to transfer 10 uL of Temperature Tube 8 (water) to\n    #          Thermocycler Tube 5A.\n    # 7.14     Mix Thermocycler Tube 5A.\n    # 7.15     Discard Tip.\n    # 7.16     Repeat steps 7.13 -7.15 for transfers from Temperature Tube 8\n    #          to Thermocycler Tubes 5B,5C,5D,5E,5F,5G, 5H.\n    # well volume: 20 + 10 = 30\n    transfer_reagent(\n        dna_sample_column=DNA_target_col_2,\n        reagent=dH2O,\n        reag_vol=10,\n        well_mixing_vol=20,\n        reagent_mix=False)\n    # 7.17     Use P20 to mix Temperature Tube 9 (APOBEC Master Mix).\n    # 7.18     Use P20 to transfer 20 uL of Temperature Tube 9 to Thermocycler\n    #          Tube 5A.\n    # 7.19     Mix Thermocycler Tube 5A.\n    # 7.20     Discard Tip.\n    # 7.21     Repeat steps 7.17 -7.20 for transfers from Temperature Tube 9 to\n    #          Thermocycler Tubes 5B,5C,5D,5E,5F,5G, 5H.\n    transfer_reagent(\n        dna_sample_column=DNA_target_col_2,\n        reagent=APOBEC_mix,\n        reag_vol=20,\n        well_mixing_vol=20)\n    # 7.22     Close lid.\n    tc_mod.close_lid()\n    # 7.23     Incubate at 37C for 3 hours.\n    tc_mod.set_block_temperature(37, hold_time_minutes=60*3)\n    # 7.24     Incubate at 4C for 3 minutes.\n    tc_mod.set_block_temperature(4, hold_time_minutes=3)\n    # 7.25     Open lid.\n    tc_mod.open_lid()\n\n    ctx.comment(\"\\n\\nStep 8: AMPure cleanup #3\\n\")\n    # 8.1 Use 8-channel P300 to mix Reservoir Well 1\n    #     (Ampure Beads - High Viscosity).\n    # 8.2 Transfer 100 uL of Reservoir Well 1 to Magnet Wells Column 5 A-H.\n    # 8.3 Transfer 50 uL of Thermocycler Column 5 A-H to Magnet Wells\n    #     Column 5 A-H.\n    # 8.4 Mix Magnet Wells Column 5 A-H at 1 minute intervals for 10 minutes.\n    # 8.5 Engage magnet.\n    # 8.6 Hold for 5 minutes (magnet still engaged).\n    # 8.7 Remove 150 uL from Magnet Wells Column 5 A-H.\n    # 8.8 Discard tips.\n    # 8.9 Use 8-channel P300 to mix Reservoir Well 5 (80% EtOH -low viscosity)\n    # 8.10 Transfer 200 uL of Reservoir Well 5 to Magnet Wells Column 5 A-H.\n    # 8.11 Slowly mix Magnet Wells Column 5 A-H 10 times. (Magnet still\n    #      engaged, washing bead pellet).\n    # 8.12 Remove 200 uL from Magnet Wells Column 5 A-H.\n    # 8.13 Discard tips.\n    # 8.14 Use 8-channel P300 to mix Reservoir Well 5 (80% EtOH -low viscosity)\n    # 8.15 Transfer 200 uL of Reservoir Well 5 to Magnet Wells Column 5 A-H.\n    # 8.16 Slowly mix Magnet Wells Column 5 A-H 10 times. (Magnet still\n    #      engaged, washing bead pellet).\n    # 8.17 Remove 200 uL from Magnet Wells Column 5 A-H.\n    # 8.18 Discard tips.\n    # 8.19 Hold for 10 minutes (magnet still engaged) to let residual\n    #      ethanol evaporate.\n    # 8.20 Close thermocycler lid.\n    # 8.21 Heat thermocycler to 37C for 2 minutes.\n    # 8.22 Open thermocycler lid.\n    # 8.23 Disengage magnet.\n    # 8.24 Use 8-channel P300 to transfer 30 uL of water from Thermocycler\n    #      Column 11 Rows A-H to Magnet Wells Column 5 A-H. Dispense liquid\n    #      over the side of the tube with the magnetic contact.\n    # 8.25 Mix Magnet Wells Column 5 A-H at 1 minute intervals for\n    #      10 minutes (eluting DNA from beads).\n    # 8.26 Engage magnet.\n    # 8.27 Hold for 3 minutes (magnet still engaged).\n    # 8.28 Transfer 29 uL from Magnet Wells Column 5 A-H to Thermocycler\n    #      Column 7 Rows A-H.\n    # 8.29 Discard tips.\n    # 8.30 Disengage magnet.\n\n    bead_cleanup(\n        mix_vol=200,\n        bead_vol=100,\n        dna_vol=50,\n        DNA_source_col=DNA_target_col_2,\n        mag_target_col=mag_target_col_3,\n        dna_air_gap_vol=10,\n        supernatant_vol=150,\n        resusp_water_vol=30,\n        water_column=water_col_3_30ul,\n        purified_DNA_vol=29,\n        purified_dna_target_col=DNA_target_col_3)\n\n    ctx.comment(\"\\n\\nStep 9: PCR Master Mix Prep\\n\")\n\n    # 9.1      Use P20 to mix Temperature Tube 10 (PCR Master Mix).\n    # 9.2      Transfer 20 uL of Temperature Tube 10 to Thermocycler Tube 7A.\n    # 9.3      Mix Thermocycler Tube 7A.\n    # 9.4      Discard Tip.\n    # 9.5      Repeat steps 9.1 -9.4 for transfers from Temperature Tube 10 to\n    #          Thermocycler Tubes 7B,7C,7D,7E,7F,7G, 7H.\n    # Well volume: 29 uL initial vol + 20 uL PCR mix = 49 uL\n    transfer_reagent(\n        dna_sample_column=DNA_target_col_3,\n        reagent=pcr_mix,\n        reag_vol=20,\n        well_mixing_vol=20)\n    # 9.6      Use P20 to mix Temperature Tube 11 (Barcode Primer 1).\n    # 9.7      Transfer 1 uL of Temperature Tube 11 to Thermocycler Tube 7A.\n    # 9.8      Mix Thermocycler Tube 7A.\n    # 9.9       Discard Tip.\n    # 9.10     Use P20 to mix Temperature Tube 12 (Barcode Primer 2).\n    # 9.11     Transfer 1 uL of Temperature Tube 12 to Thermocycler Tube 7B.\n    # 9.12     Mix Thermocycler Tube 7B.\n    # 9.13     Discard Tip.\n    # 9.14     Use P20 to mix Temperature Tube 13 (Barcode Primer 3).\n    # 9.15     Transfer 1 uL of Temperature Tube 13 to Thermocycler Tube 7C.\n    # 9.16     Mix Thermocycler Tube 7C.\n    # 9.17     Discard Tip.\n    # 9.18     Use P20 to mix Temperature Tube 14 (Barcode Primer 4).\n    # 9.19     Transfer 1 uL of Temperature Tube 14 to Thermocycler Tube 7D.\n    # 9.20     Mix Thermocycler Tube 7D.\n    # 9.21     Use P20 to mix Temperature Tube 15 (Barcode Primer 5).\n    # 9.22     Transfer 1 uL of Temperature Tube 15 to Thermocycler Tube 7E.\n    # 9.23     Mix Thermocycler Tube 7E.\n    # 9.24     Discard Tip.\n    # 9.25     Use P20 to mix Temperature Tube 16 (Barcode Primer 6).\n    # 9.26     Transfer 1 uL of Temperature Tube 16 to Thermocycler Tube 7F.\n    # 9.27     Mix Thermocycler Tube 7F.\n    # 9.28     Use P20 to mix Temperature Tube 17 (Barcode Primer 7).\n    # 9.29     Transfer 1 uL of Temperature Tube 17 to Thermocycler Tube 7G.\n    # 9.30     Mix Thermocycler Tube 7G.\n    # 9.31     Discard Tip.\n    # 9.32     Use P20 to mix Temperature Tube 18 (Barcode Primer 8).\n    # 9.33     Transfer 1 uL of Temperature Tube 18 to Thermocycler Tube 7H.\n    # 9.34     Mix Thermocycler Tube 7H.\n    # 9.35     Discard Tip.\n    for barcode_tube, d_well in zip(barcodes, DNA_target_col_3):\n        pick_up(p20)\n        mix_vol = barcode_tube_init_vol - 2\n        mix_vol = barcode_tube_init_vol if barcode_tube_init_vol < 20 else 20\n        p20.mix(num_mix_repns, mix_vol, barcode_tube)\n        p20.aspirate(1, barcode_tube)\n        p20.dispense(1, d_well)\n        # The volume in the d_well is 29+1 = 30 uL, mix using 20 uL\n        p20.mix(num_mix_repns, 20, d_well)\n        p20.drop_tip()\n    # 9.36     Close lid.\n    tc_mod.close_lid()\n    # 9.37     Incubate at 95C for 30 sec.\n    tc_mod.set_block_temperature(95, hold_time_seconds=30)\n    # 9.38     Cycle temperature: 94C for 30 seconds and 60 degrees for 3\n    #          minutes for 25 cycles.\n    # The well volume is 49 + 1 = 50 uL\n    pcr_cycle_profile = [\n        {'temperature': 94, 'hold_time_seconds': 30},\n        {'temperature': 60, 'hold_time_minutes': 3}]\n    tc_mod.execute_profile(\n        steps=pcr_cycle_profile, repetitions=25, block_max_volume=50)\n    # 9.39     Incubate at 4C for 3 minutes.\n    tc_mod.set_block_temperature(4, hold_time_minutes=3)\n    # 9.40     Open lid.\n    tc_mod.open_lid()\n\n    ctx.comment(\"\\n\\nStep 10: AMPure cleanup #4\\n\")\n    # 10.1 Use 8-channel P300 to mix Reservoir Well 1 (Ampure Beads - High\n    #      Viscosity).\n    # 10.2 Transfer 100 uL of Reservoir Well 1 to Magnet Wells Column 7 A-H.\n    # 10.3 Transfer 50 uL of Thermocycler Column 7 A-H to Magnet Wells\n    #      Column 7 A-H.\n    # 10.4 Mix Magnet Wells Column 7 A-H at 1 minute intervals for 10 minutes.\n    # 10.5 Engage magnet.\n    # 10.6 Hold for 5 minutes (magnet still engaged).\n    # 10.7 Remove 150 uL from Magnet Wells Column 7 A-H.\n    # 10.8 Discard tips.\n    # 10.9 Use 8-channel P300 to mix Reservoir Well 5 (80% EtOH -low viscosity)\n    # 10.10 Transfer 200 uL of Reservoir Well 5 to Magnet Wells Column 7 A-H.\n    # 10.11 Slowly mix Magnet Wells Column 7 A-H 10 times. (Magnet still\n    #       engaged, washing bead pellet).\n    # 10.12 Remove 200 uL from Magnet Wells Column 7 A-H.\n    # 10.13 Discard tips.\n    # 10.14 Use 8-channel P300 to mix Reservoir Well 5\n    #       (80% EtOH -low viscosity)\n    # 10.15 Transfer 200 uL of Reservoir Well 5 to Magnet Wells Column 7 A-H.\n    # 10.16 Slowly mix Magnet Wells Column 7 A-H 10 times.\n    #       (Magnet still engaged, washing bead pellet).\n    # 10.17 Remove 200 uL from Magnet Wells Column 7 A-H.\n    # 10.18 Discard tips.\n    # 10.19 Hold for 10 minutes (magnet still engaged) to let residual\n    #       ethanol evaporate.\n    # 10.20 Close thermocycler lid.\n    # 10.21 Heat thermocycler to 37C for 2 minutes.\n    # 10.22 Open thermocycler lid.\n    # 10.23 Disengage magnet.\n    # 10.24 Use 8-channel P300 to transfer 42 uL of water from Thermocycler\n    #       Column 12 Rows A-H to Magnet Wells Column 7 A-H. Dispense liquid\n    #       over the side of the tube with the magnetic contact.\n    # 10.25 Mix Magnet Wells Column 7 A-H at 1 minute intervals for 10 minutes\n    #       (eluting DNA from beads).\n    # 10.26 Engage magnet.\n    # 10.27 Hold for 3 minutes (magnet still engaged).\n    # 10.28 Transfer 40 uL from Magnet Wells Column 7 A-H to Thermocycler\n    #       Column 9 Rows A-H.\n    # 10.29 Discard tips.\n    # 10.30 Disengage magnet.\n\n    bead_cleanup(\n        mix_vol=200,\n        bead_vol=100,\n        dna_vol=50,\n        DNA_source_col=DNA_target_col_3,\n        mag_target_col=mag_target_col_4,\n        dna_air_gap_vol=10,\n        supernatant_vol=150,\n        resusp_water_vol=42,\n        water_column=water_col_4_42ul,\n        purified_DNA_vol=40,\n        purified_dna_target_col=DNA_target_col_4)\n\n    # 10.31 Close thermocycler lid.\n    tc_mod.close_lid()\n    # 10.32 Hold thermocycler at 4C.\n    tc_mod.set_block_temperature(4)\n    # 10.33 Alert user that the protocol has finished.\n    ctx.comment(\"\\n\\n ~~~ Protocol Finished!  ~~~ \\n\")\n    initial_light_state = ctx.rail_lights_on\n    opposite_state = not initial_light_state\n    if is_flash_lights:\n        for _ in range(5):\n            ctx.set_rail_lights(opposite_state)\n            ctx.delay(seconds=0.5)\n            ctx.set_rail_lights(initial_light_state)\n            ctx.delay(seconds=0.5)\n",
    "custom_labware_defs": [],
    "fields": [
        {
            "label": "p20 single channel pipette mount",
            "name": "p20_mount",
            "options": [
                {
                    "label": "Left",
                    "value": "left"
                },
                {
                    "label": "Right",
                    "value": "right"
                }
            ],
            "type": "dropDown"
        },
        {
            "label": "96 well plate type",
            "name": "plate_lname",
            "options": [
                {
                    "label": "NEST 96 Well Plate 200 \u00b5L Flat",
                    "value": "nest_96_wellplate_200ul_flat"
                },
                {
                    "label": "Bio-Rad 96 Well Plate 200 \u00b5L PCR",
                    "value": "biorad_96_wellplate_200ul_pcr"
                },
                {
                    "label": "Corning 96 well Plate 360 \u00b5L Flat",
                    "value": "corning_96_wellplate_360_ul_flat"
                },
                {
                    "label": "NEST 96 Well Plate 100 \u00b5L PCR Full Skirt",
                    "value": "nest_96_wellplate_100ul_pcr_full_skirt"
                },
                {
                    "label": "NEST 96 Deepwell plate 2 mL",
                    "value": "nest_96_wellplate_2ml_deep"
                },
                {
                    "label": "USA Scientific 96 Deep well Plate 2.4 mL",
                    "value": "usascientific_96_wellplate_2.4ml_deep"
                }
            ],
            "type": "dropDown"
        },
        {
            "label": "Reagent aluminum block tube type",
            "name": "alum_block_tubes_lname",
            "options": [
                {
                    "label": "Opentrons 24 Well Aluminum Block with NEST 1.5 mL Snapcap",
                    "value": "opentrons_24_aluminumblock_nest_1.5ml_snapcap"
                },
                {
                    "label": "Opentrons 24 Well Aluminum Block with NEST 0.5 mL Screwcap",
                    "value": "opentrons_24_aluminumblock_nest_0.5ml_screwcap"
                },
                {
                    "label": "Opentrons 24 Well Aluminum Block with NEST 1.5 mL Screwcap",
                    "value": "opentrons_24_aluminumblock_nest_1.5ml_screwcap"
                },
                {
                    "label": "Opentrons 24 Well Aluminum Block with NEST 2 mL Snapcap",
                    "value": "opentrons_24_aluminumblock_nest_2ml_snapcap"
                },
                {
                    "label": "Opentrons 24 Well Aluminum Block with NEST 2 mL Screwcap",
                    "value": "opentrons_24_aluminumblock_nest_2ml_screwcap"
                },
                {
                    "label": "Opentrons 24 Well Aluminum Block with Generic 2 mL Screwcap",
                    "value": "opentrons_24_aluminumblock_generic_2ml_screwcap"
                }
            ],
            "type": "dropDown"
        },
        {
            "default": 10,
            "label": "Barcode tubes initial volume (\u00b5L)",
            "name": "barcode_tube_init_vol",
            "type": "float"
        },
        {
            "default": 3.45,
            "label": "Magnet engagement height (mm)",
            "name": "mag_engage_height",
            "type": "float"
        },
        {
            "default": 10,
            "label": "Number of mixing repetitions",
            "name": "num_mix_repns",
            "type": "int"
        },
        {
            "label": "Flash the OT-2 lights when the protocol finishes?",
            "name": "is_flash_lights",
            "options": [
                {
                    "label": "Yes",
                    "value": true
                },
                {
                    "label": "No",
                    "value": false
                }
            ],
            "type": "dropDown"
        }
    ],
    "instruments": [
        {
            "mount": "left",
            "name": "p20_single_gen2"
        },
        {
            "mount": "right",
            "name": "p300_multi_gen2"
        }
    ],
    "labware": [
        {
            "name": "Opentrons 24 Well Aluminum Block with NEST 1.5 mL Snapcap on Temperature Module GEN2 on 1",
            "share": false,
            "slot": "1",
            "type": "opentrons_24_aluminumblock_nest_1.5ml_snapcap"
        },
        {
            "name": "Opentrons 96 Filter Tip Rack 20 \u00b5L on 2",
            "share": false,
            "slot": "2",
            "type": "opentrons_96_filtertiprack_20ul"
        },
        {
            "name": "NEST 96 Well Plate 200 \u00b5L Flat on Magnetic Module GEN2 on 4",
            "share": false,
            "slot": "4",
            "type": "nest_96_wellplate_200ul_flat"
        },
        {
            "name": "6 on 5",
            "share": false,
            "slot": "5",
            "type": "opentrons_96_filtertiprack_200ul"
        },
        {
            "name": "NEST 96 Well Plate 200 \u00b5L Flat on Thermocycler Module on 7",
            "share": false,
            "slot": "7",
            "type": "nest_96_wellplate_200ul_flat"
        },
        {
            "name": "NEST 12 Well Reservoir 15 mL on 9",
            "share": false,
            "slot": "9",
            "type": "nest_12_reservoir_15ml"
        },
        {
            "name": "Opentrons Fixed Trash on 12",
            "share": false,
            "slot": "12",
            "type": "opentrons_1_trash_1100ml_fixed"
        }
    ],
    "metadata": {
        "apiLevel": "2.11",
        "author": "Eskil Andersen <eskil.andersen@opentrons.com>",
        "protocolName": "MethylPatch Protocol for Opentrons OT-2",
        "source": "Custom Protocol Request"
    },
    "modules": []
}